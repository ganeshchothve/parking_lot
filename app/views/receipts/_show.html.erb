<div class="container bg-light">
  <div class="pt-3"></div>
  <div class="card">
    <div class="card-header">
      Receipt
      <div class="dropdown float-right d-print-none">
        <a class="btn btn-light dropdown-toggle" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</a>
        <div class="dropdown-menu dropdown-menu-right">
          <button onclick="window.print();" class="dropdown-item ">Print</button>
          <% if policy([:admin, SyncLog.new]).resync? && receipt.sync_logs.present? %>
            <%= link_to "Resync", resync_admin_sync_log_path(receipt.sync_logs.desc(:created_at)[0]), class: "dropdown-item" %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="logo-wrapper">
            <%= image_tag current_client.logo.url %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mt-2 mb-1 small text-muted">Receipt ID</div>
          <h5><%= @receipt.receipt_id %></h5>
          <div class="d-print-none">
            <% if policy([:admin, SyncLog.new]).resync? %>
              <div class="mt-2 mb-1 small text-muted">Last Synced At</div>
              <% if receipt.sync_logs.present? %>
                <h5><%= receipt.sync_logs.desc(:created_at)[0].present? ? receipt.sync_logs.desc(:created_at)[0].updated_at.strftime("%d/%m/%Y %l:%M %p") : "-" %></h5>
              <% else %>
                <h5><%= "Not synced" %></h5>
              <% end %>
              <div class="mt-2 mb-1 small text-muted">Last Sync Log Status</div>
              <% if receipt.sync_logs.present? %>
                <h5><%= receipt.sync_logs.desc(:created_at)[0].status.present? ? receipt.sync_logs.desc(:created_at)[0].status : "-" %></h5>
              <% else %>
                <h5><%= "Not synced" %></h5>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-3"></div>
  <div class="row">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="form-group">
            <label class="small text-muted">Paid By:</label>
            <div><%= @receipt.primary_user_kyc.name %></div>
          </div>
          <div class="form-group">
            <label class="small text-muted">Email:</label>
            <div><%= @receipt.primary_user_kyc.email %></div>
          </div>
          <div class="form-group">
            <label class="small text-muted">Phone:</label>
            <div><%= @receipt.primary_user_kyc.phone %></div>
          </div>
          <div class="form-group">
            <label class="small text-muted">PAN Number:</label>
            <div><%= @receipt.primary_user_kyc.pan_number %></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="form-group">
            <label class="small text-muted">Paid To:</label>
            <div><%= current_client.registration_name %></div>
          </div>
          <% if current_client.cin_number.present? %>
            <div class="form-group">
              <label class="small text-muted">CIN Number:</label>
              <div><%= current_client.cin_number %></div>
            </div>
          <% end %>
          <% if current_client.address.present? %>
            <div class="form-group">
              <label class="small text-muted">Address: </label>
              <div><%= current_client.address.to_sentence %></div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-3"></div>
  <%= current_client.templates.where(_type: "Template::ReceiptTemplate").first.parsed_content(@receipt) %>
  <div class="mt-3"></div>
  <div class="card">
    <div class="card-body">
      <div class="float-right text-right">
        <strong>For <%= current_client.registration_name %></strong>
        <br/><br/><br/>
        Authorized Signatory
      </div>
    </div>
  </div>
  <div class="text-center text-muted small mt-3">This is an electronically generated receipt; hence no signature is required.</div>
  <div class="pt-3"></div>
</div>
