<%
if current_user.buyer?
  if @user_kyc.persisted?
    url = user_kyc_path(@user_kyc)
  else
    url = user_kycs_path
  end
else
  if @user_kyc.persisted?
    url = admin_user_user_kyc_path(@user, @user_kyc)
  else
    url = admin_user_user_kycs_path(@user)
  end
end
%>
<%= form_for(@user_kyc, local: true, url: url, remote: true, html: {class: 'modal-remote-form validate-form', "data-resource-type": global_labels['user_kycs'], "data-type": "json", id: 'user_kyc_form'}) do |f| %>
<div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><%= @user_kyc.new_record? ? "New" : "Edit" %> <%= "#{global_labels['user_kyc']}" %></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-2">
            <div class="form-group">
              <%= f.label :salutation, class: 'required' %>
              <%= f.select :salutation, UserKyc.available_salutations.collect{|x| [x[:text], x[:id]]}, {prompt: "Select"}, class: 'selectize', required: 'required' %>
            </div>
          </div>
          <div class="col-5">
            <div class="form-group">
          <%= f.label :first_name, class: 'required' %>
          <%= f.text_field :first_name, class: 'form-control', required: 'required', placeholder: 'First Name' %>
        </div>
          </div>
          <div class="col-5">
            <div class="form-group">
          <%= f.label :last_name, class: 'required' %>
          <%= f.text_field :last_name, class: 'form-control', required: 'required', placeholder: 'Last Name' %>
        </div>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <div class="form-group">
          <%= f.label :phone, class: 'required' %>
          <%= f.text_field :phone, class: 'form-control phone', required: 'required', placeholder:'Phone'%>
        </div>
          </div>
          <div class="col-6">
            <div class="form-group">
          <%= f.label :email, class: 'required' %>
          <%= f.email_field :email, class: 'form-control', required: 'required', placeholder:'Email' %>
        </div>
          </div>
        </div>
        <div class="form-group position-relative">
          <!-- TODO: check if you want to restrict the dob to 18 years age -->
          <%= f.label :dob, class: 'required' %>
          <% date = (f.object.dob.present? ? f.object.dob.strftime("%d/%m/%Y") : Date.today.strftime("%d/%m/%Y")) %>
          <%= f.text_field :dob, class: 'form-control datepicker', required: 'required', type:'text', placeholder:'Date of birth', data: {"default-date": date}, value: date %>
        </div>
        <div class="row">
          <div class="col-6">
            <div class="form-group">
              <%= f.label :pan_number %>
              <%= f.text_field :pan_number, class: 'form-control', required: 'required', placeholder: 'PAN Number' %>
            </div>
          </div>
          <div class="col-6">
            <div class="form-group">
              <%= f.label :aadhaar %>
              <%= f.text_field :aadhaar, class: 'form-control', required: 'required', placeholder: 'Enter your 12 digit Aadhaar No.' %>
            </div>
          </div>
        </div>
        <% if params[:project_unit_id].present? %>
        <%
        @user_kyc.project_unit_ids += [params[:project_unit_id]]
        @user_kyc.project_unit_ids.uniq!
        %>
        <% end %>
        <% if @user.project_unit_ids.present? %>
        <div class="form-group position-relative">
          <%= f.label :project_unit_ids, class: 'required' %>
          <%= f.select :project_unit_ids, @user.project_units.collect{|x| [x.name, x.id]}, {prompt: "Select"}, class: 'selectize', multiple: true, placeholder: "Related Project Units (Co-applicants for)" %>
        </div>
        <% end %>
        <% if !defined?(small) || small == false %>
          <div class="form-group">
            <%= f.label :nri %><br/>
            <div class="form-check form-check-inline">
              <%= f.radio_button :nri, "yes", class: "form-check-input" %>
              <%= f.label :nri, "Yes", class: "form-check-label" %>
            </div>
            <div class="form-check form-check-inline">
              <%= f.radio_button :nri, "no", class: "form-check-input" %>
              <%= f.label :nri, "No", class: "form-check-label" %>
            </div>
          </div>
          <div class="form-field-wrapper">
            <%= f.label :oci %>
            <%= f.text_field :oci, class: 'form-control', placeholder: 'OCI' %>
          </div>
          <div class="form-group">
            <%= f.label :poa %><br/>
            <div class="form-check form-check-inline">
              <%= f.radio_button :poa, "yes", class: "form-check-input" %>
              <%= f.label :poa, "Yes", class: "form-check-label" %>
            </div>
            <div class="form-check form-check-inline">
              <%= f.radio_button :poa, "no", class: "form-check-input" %>
              <%= f.label :poa, "No", class: "form-check-label" %>
            </div>
          </div>
          <div class="form-group">
            <%= f.label :poa_details %>
            <%= f.text_field :poa_details, class: 'form-control', placeholder: 'Name' %>
          </div>
          <div class="form-group">
            <%= f.label :poa_details_phone_no %>
            <%= f.text_field :poa_details_phone_no, class: 'phone form-control', placeholder: 'Phone No.' %>
          </div>
          <div class="form-group">
            <%= f.label :gstn %>
            <%= f.text_field :gstn, class: 'form-control', placeholder:'GSTIN' %>
          </div>
          <div class="form-group">
            <%= f.label :is_company %><br/>
            <div class="form-check form-check-inline">
              <%= f.radio_button :is_company, "yes", class: "form-check-input" %>
              <%= f.label :is_company, "Yes", class: "form-check-label" %>
            </div>
            <div class="form-check form-check-inline">
              <%= f.radio_button :is_company, "no", class: "form-check-input" %>
              <%= f.label :is_company, "No", class: "form-check-label" %>
            </div>
          </div>
          <div class="form-group">
            <%= f.label :company_name %>
            <%= f.text_field :company_name, class: 'form-control', placeholder: 'Company Name' %>
          </div>
          <div class="form-group">
            <%= f.label :comments, class: 'control-label', style: 'vertical-align:middle' %>
            <%= f.text_area :comments, class: 'form-control', style: 'vertical-align:middle' %>
          </div>
        <% end %>
      </div>
      <div class="modal-footer">
        <%= f.submit "Save", class: "btn btn-primary" %>
      </div>
    </div>
  </div>
</div>
<% end %>
<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($("#user_kyc_form"));
});
<% end %>
