<div class="container">
  <div class="row justify-content-center">
    <div class="col-12">
      <% unless current_user.buyer? %>
        <div class="alert alert-danger">
          You are taking a booking for <%= @user.name %>
        </div>
        <div class="mt-3"></div>
      <% end %>
      <%= render "form", {data: @data} %>
      <div class="mt-3"></div>
      <div class="row continuous-row">
        <% @towers.sort{|a,b| a[:project_tower_name] <=> b[:project_tower_name]}.each do |tower| %>
          <div class="col-4">
            <div class="card" data-jquery-selector="tower-card" data-tower-id="<%= tower[:project_tower_id] %>">
              <div class="card-body">
                <div class="form-group">
                  <%= tower[:project_tower_name] %>
                </div>
                <div class="row">
                  <div class="col-6">
                    <div class="form-group">
                      <label class="small">Tower Units</label>
                      <div><%= tower[:total_units] %></div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-group">
                      <label class="small">Available Units</label>
                      <div><%= tower[:total_units_available] %></div>
                    </div>
                  </div>
                </div>
                <!-- GENERIC_TODO : implement floorplan image here -->
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <% if @search.next_step.present? %>
        <%= form_for [:user, @search], html: {class: 'validate-form', id: "edit_search_form"} do |f| %>
          <div class="form-group">
            <%= f.hidden_field :step, value: @search.next_step %>
            <%= f.hidden_field :project_tower_id %>
          </div>
          <div class="form-group">
            <%= f.submit "Next", class: "btn btn-primary float-left", disabled: 'disabled' %>
          </div>
        <% end %>
      <% end %>
      <% if @search.previous_step.present? %>
        <%= form_for [:user, @search], html: {class: 'validate-form'} do |f| %>
          <div class="form-group">
            <%= f.hidden_field :step, value: @search.previous_step %>
          </div>
          <div class="form-group">
            <%= f.submit "Previous", class: "btn btn-secondary float-right" %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
<%= javascript_tag do %>
$(document).on('click', '[data-jquery-selector="tower-card"]', function(){
  var $form = $("#edit_search_form");
  $form.find('[name="search[project_tower_id]"]').val($(this).data("tower-id"));
  $form.find('input[type="submit"]').removeAttr("disabled");
});
<% end %>
