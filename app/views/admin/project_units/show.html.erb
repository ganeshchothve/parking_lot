<%- if !params[:layout].blank? %>
  <div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

<%- else %>
  <div class="container form-group mt-3 text-right">
    <div class="row">
      <div class="col-12">
        <button onclick="window.print();" class="btn btn-primary d-print-none">Print</button>
      </div>
    </div>
  </div>
<%- end %>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <%= render 'dashboard/booking_detail_overview', { booking_detail: @booking_detail } %>
      <div class="text-muted small help-block">Select scheme below to view cost for this unit.</div>
      <% if @project_unit.available? %>
        <div class="mt-3"></div>
        <div class="d-print-none card">
          <div class="card-header">
            Select a <%= global_labels[:scheme] %>
          </div>
          <div class="card-body">
            <%= render 'admin/project_units/booking_detail_scheme_form', {booking_detail: @booking_detail, booking_detail_scheme: @booking_detail_scheme, url: admin_project_unit_path(@project_unit) } %>
          </div>
        </div>
      <% end %>
      <% if @booking_details.present? %>
        <div class="mt-3"></div>
        <div class="card">
          <div class = "card-header">Bookings</div>
          <div class="card-body">
            <%= render 'admin/booking_details/index', { booking_details: @booking_details } %>
          </div>
        </div>
      <% end %>
      <div class="mt-4"></div>
      <% if params[:booking_detail_scheme] %>
        <%= render 'dashboard/booking_detail_cost_sheet', booking_detail: @booking_detail %>
        <div class="page-break"></div>
        <div class="mt-3"></div>
        <%= render "dashboard/project_unit_payment_schedule", project_unit: @project_unit %>
        <div class="mt-3"></div>
      <% end %>
      <div class="d-print-none">
        <% if @project_unit.assets.present? %>
          <div class="card card-body">
            <div id="project_unit_gallery_<%= @project_unit.id %>" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">'
              <% @project_unit.assets.each_with_index do |asset, index| %>
                <li data-target="#project_unit_gallery_<%= @project_unit.id %>" data-slide-to="<%= index %>" class="<%= index.zero? ? "active" : "" %>"></li>
              <% end %>
            </ol>
            <div class="carousel-inner">
              <% @project_unit.assets.each_with_index do |asset, index| %>
                <div class="carousel-item <%= index.zero? ? "active" : "" %>">
                  <img class="d-block w-100" src="<%= asset.file.url %>" />
                </div>
              <% end %>
            </div>
            <a class="carousel-control-prev" href="#project_unit_gallery_<%= @project_unit.id %>" role="button" data-slide="prev">
              <span class="fas fa-chevron-left text-dark" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#project_unit_gallery_<%= @project_unit.id %>" role="button" data-slide="next">
              <span class="fas fa-chevron-right text-dark" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
          </div>
        <% else %>
          <div class="alert alert-primary">
            No images available
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%- if !params[:layout].blank? %>
      </div>
    </div>
  </div>
</div>
<%- end %>

<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($("#scheme_form"));
  var payment_adjustment_html = function(record){
    return '<div class="row">\
      <div class="col-md-4">\
        <p>Name</p>\
        <p>' + record.name + '</p>\
      </div>\
      <div class="col-md-4">\
        <p>Field</p>\
        <p>' + record.field + '</p>\
      </div>\
      <div class="col-md-4">\
        <p>Value</p>\
        <p>' + record.value + '</p>\
      </div>\
    </div>'
  }
  $('[name="booking_detail_scheme[derived_from_scheme_id]"]').change(function(){
    $(".non-editable-payment-adjustments").html("");
    $(".payment-adjustments").html("");
    $.ajax({
      url: "/admin/schemes/" + $(this).val() + "/payment_adjustments_for_unit",
      type: "GET",
      dataType: 'json',
      data: {
        project_unit_id: "<%= @booking_detail.project_unit.id %>"
      },
      success: function(data, xhr, status){
        _.each(data, function(record){
          var html = payment_adjustment_html(record);
          $(".non-editable-payment-adjustments").append(html);
        })
      }, error: function(){

      }
    })
  });
});
<% end %>
