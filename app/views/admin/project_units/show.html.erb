<%- if !params[:layout].blank? %>
  <div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

<%- else %>
  <div class="container form-group mt-3 text-right">
    <div class="row">
      <div class="col-12">
        <button onclick="window.print();" class="btn btn-primary d-print-none">Print</button>
      </div>
    </div>
  </div>
<%- end %>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <%= render 'dashboard/project_unit_overview', { project_unit: @project_unit, scheme: @scheme } %>
      <div class="text-muted small help-block">Select scheme below to view cost for this unit.</div>
      <% if @project_unit.available? %>
        <div class="mt-3"></div>
        <div class="d-print-none card">
          <div class="card-header">
            Select a <%= global_labels[:scheme] %>
          </div>
          <div class="card-body">
            <%= form_tag [current_user_role_group, @project_unit], method: "get", id: "project_unit_scheme_preview_form", remote: !params[:layout].blank? do %>
              <div class="form-group">
                <%= label_tag :scheme_id, "Scheme", class: "control-label" %>
                <%= select_tag :selected_scheme_id, options_from_collection_for_select(Scheme.where(_id: params[:selected_scheme_id]), 'id', 'name', params[:selected_scheme_id]), {prompt: 'Please Select Atleast one Scheme', class: 'selectize-remote', required: 'required', autofocus: true, data: { url: admin_schemes_path, params: {fltrs: { project_tower: @project_unit.project_tower_id, can_be_applied_by: current_user.role, status: 'approved' } } } }%>
              </div>
              <%- if !params[:layout].blank? %>
                <%= hidden_field_tag :layout, 'false' %>
              <% end %>
              <div class="form-group">
                <%= submit_tag :Apply, class: "btn btn-primary #{!params[:layout].blank? ? 'modal-remote-form-link' : '' }" %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
      <% if @booking_details.present? %>
        <div class="mt-3"></div>
        <div class="card">
          <div class = "card-header">Bookings</div>
          <div class="card-body">
            <%= render 'admin/booking_details/index', { booking_details: @booking_details } %>
          </div>
        </div>
      <% end %>
      <div class="mt-4"></div>
      <% if params[:selected_scheme_id] && @scheme.present? %>
        <div class='row mb-2'>
          <div class='col-12'>
            <%= link_to "Print Cost Sheet & Payment Schedule", print_admin_project_unit_path(@project_unit, {selected_scheme_id: params[:selected_scheme_id]}), class: 'btn btn-sm btn-primary float-right', target: "_blank" %>
          </div>
        </div>
        <%= render 'dashboard/project_unit_cost_sheet', project_unit: @project_unit %>
        <div class="page-break"></div>
        <div class="mt-3"></div>
        <%= render "dashboard/project_unit_payment_schedule", project_unit: @project_unit %>
        <div class="mt-3"></div>
      <% end %>
      <div class="d-print-none">
        <% if @project_unit.assets.present? %>
          <div class="card card-body">
            <div id="project_unit_gallery_<%= @project_unit.id %>" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">'
              <% @project_unit.assets.each_with_index do |asset, index| %>
                <li data-target="#project_unit_gallery_<%= @project_unit.id %>" data-slide-to="<%= index %>" class="<%= index.zero? ? "active" : "" %>"></li>
              <% end %>
            </ol>
            <div class="carousel-inner">
              <% @project_unit.assets.each_with_index do |asset, index| %>
                <div class="carousel-item <%= index.zero? ? "active" : "" %>">
                  <img class="d-block w-100" src="<%= asset.file.url %>" />
                </div>
              <% end %>
            </div>
            <a class="carousel-control-prev" href="#project_unit_gallery_<%= @project_unit.id %>" role="button" data-slide="prev">
              <span class="fas fa-chevron-left text-dark" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#project_unit_gallery_<%= @project_unit.id %>" role="button" data-slide="next">
              <span class="fas fa-chevron-right text-dark" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
          </div>
        <% else %>
          <div class="alert alert-primary">
            No images available
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%- if !params[:layout].blank? %>
      </div>
    </div>
  </div>
</div>
<%- end %>
<%= javascript_tag do %>
  $(document).ready(function(){
    FormInitializer.init($("#project_unit_scheme_preview_form"))
  });
<% end %>
