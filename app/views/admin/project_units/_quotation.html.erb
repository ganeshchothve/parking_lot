<div class="container">
  <div class = "row justify-content-right">
    <div class = "col-md-12">
      <% if params[:booking_detail_scheme] %>
        <%= link_to "Get PDF", quotation_admin_project_unit_path(@project_unit, booking_detail_scheme: params[:booking_detail_scheme].permit(:derived_from_scheme_id, payment_adjustments_attributes: {}), format: :pdf),class: "btn btn-primary float-right", target: '_blank' %>
      <% else %>
        <%= link_to "Get PDF", quotation_admin_project_unit_path(@project_unit, format: :pdf),class: "btn btn-primary float-right", target: '_blank' %>
      <% end %>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-md-12">
      <div class="row mt-3">
        <div class="col-md-12">
          <%= render 'admin/project_units/booking_detail_scheme_form', {booking_detail: @booking_detail, booking_detail_scheme: @booking_detail_scheme, url: quotation_admin_project_unit_path(@project_unit) } %>
        </div>
      </div>
    </div>
  </div>
  <div id="project-unit-cost-details">
    <%= render 'project_unit_cost_details', locals: { booking_detail: @booking_detail } %>
  </div>
</div>

<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($("#scheme_form"));
  var payment_adjustment_html = function(record){
    return '<div class="row">\
      <div class="col-md-4">\
        <p>Name</p>\
        <p>' + record.name + '</p>\
      </div>\
      <div class="col-md-4">\
        <p>Field</p>\
        <p>' + record.field + '</p>\
      </div>\
      <div class="col-md-4">\
        <p>Value</p>\
        <p>' + record.value + '</p>\
      </div>\
    </div>'
  }
  $('[name="booking_detail_scheme[derived_from_scheme_id]"]').change(function(){
    $(".non-editable-payment-adjustments").html("");
    $(".payment-adjustments").html("");
    $.ajax({
      url: "/admin/schemes/" + $(this).val() + "/payment_adjustments_for_unit",
      type: "GET",
      dataType: 'json',
      data: {
        project_unit_id: "<%= @booking_detail.project_unit.id %>"
      },
      success: function(data, xhr, status){
        _.each(data, function(record){
          var html = payment_adjustment_html(record);
          $(".non-editable-payment-adjustments").append(html);
        })
      }, error: function(){

      }
    })
  });
});
<% end %>
