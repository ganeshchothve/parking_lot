
<div class="container">
  <div class = "row justify-content-right">
    <div class = "col-md-12">
      <% if params[:booking_detail_scheme] %>
        <%= link_to "PDF", quotation_admin_project_unit_path(@project_unit, booking_detail_scheme: params[:booking_detail_scheme].permit(:derived_from_scheme_id, payment_adjustments_attributes: {}), format: :pdf),class: "btn btn-primary float-right" %>
      <% else %>
        <%= link_to "PDF", quotation_admin_project_unit_path(@project_unit, format: :pdf),class: "btn btn-primary float-right" %>
      <% end %>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-4">
          <div class="card card-body h-100 text-center bg-primary text-white">
            To be fair to other user interested in this apartment, we have held this unit for some time. Please go through the costs & payment schedule before you make a payment of <%= number_to_indian_currency(current_client.blocking_amount) %>.<br/>
            <div class="font-weight-bold jquery-countdown-container" id="held-until-countdown"></div>
          </div>
        </div>
        <div class="col-md-8 mt-3 mt-md-0">
          <%= render 'dashboard/booking_detail_overview', {booking_detail: @booking_detail} %>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4">
      <%= render 'admin/project_units/booking_detail_scheme_form', {booking_detail: @booking_detail, booking_detail_scheme: @booking_detail_scheme, url: quotation_admin_project_unit_path(@project_unit) } %>
    </div>
    <div class="col-md-8">
      <div class="mt-3"></div>
      <div class="card">
        <div class="card-body">
          <div class="table-responsive">
            <%= @booking_detail.cost_sheet_template.parsed_content(@booking_detail) %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($("#scheme_form"));
  var payment_adjustment_html = function(record){
    return '<div class="row">\
      <div class="col-md-4">\
        <p>Name</p>\
        <p>' + record.name + '</p>\
      </div>\
      <div class="col-md-4">\
        <p>Field</p>\
        <p>' + record.field + '</p>\
      </div>\
      <div class="col-md-4">\
        <p>Value</p>\
        <p>' + record.value + '</p>\
      </div>\
    </div>'
  }
  $('[name="booking_detail_scheme[derived_from_scheme_id]"]').change(function(){
    $(".non-editable-payment-adjustments").html("");
    $(".payment-adjustments").html("");
    $.ajax({
      url: "/admin/schemes/" + $(this).val() + "/payment_adjustments_for_unit",
      type: "GET",
      dataType: 'json',
      data: {
        project_unit_id: "<%= @booking_detail.project_unit.id %>"
      },
      success: function(data, xhr, status){
        _.each(data, function(record){
          var html = payment_adjustment_html(record);
          $(".non-editable-payment-adjustments").append(html);
        })
      }, error: function(){

      }
    })
  });
});
<% end %>
