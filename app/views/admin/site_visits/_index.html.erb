<section class="mt-0">
  <div class="px-0">
    <div class="row g-0">
      <div class="col-lg-12 p-0 mt-3 table-responsive">
        <table class="table table-responsive table-color align-middle">
          <thead>
            <tr>
              <th><%= t('mongoid.attributes.site_visit.name') %></th>
              <th><%= t('mongoid.attributes.site_visit.email') %></th>
              <th><%= t('mongoid.attributes.site_visit.phone') %></th>
              <% if policy([ current_user_role_group, SiteVisit.new]).show_channel_partner? %>
                <th><%= t('mongoid.attributes.site_visit.manager_id') %></th>
              <% end %>
              <th><%= t('mongoid.attributes.site_visit.status') %></th>
              <th><%= t('mongoid.attributes.site_visit.scheduled_on') %></th>
              <th><%= t('mongoid.attributes.site_visit.project') %></th>
              <th><%= t('mongoid.attributes.site_visit.approval_status') %></th>
              <th><%= t('mongoid.attributes.site_visit.cp_manager') %></th>
              <th class="btn-action"><%= t('global.action.one') %></th>
            </tr>
          </thead>
          <tbody>
            <% site_visits.reject(&:new_record?).each_with_index do |site_visit, index| %>

            <tr>
              <td>
                <% if policy([ current_user_role_group, site_visit]).show? %>
                <%= link_to site_visit.lead.name, [current_user_role_group, site_visit], class: 'theme-txt-color' %>
                <% else %>
                <%= site_visit.lead.name %>
                <% end %>
              </td>
              <td>
                <% if site_visit.lead&.email.present? %>
                <%= site_visit.lead.masked_email(current_user) || '-' %>
                <% end %>
              </td>
              <td>
                <% if site_visit.lead&.phone.present? %>
                <%= site_visit.lead.masked_phone(current_user) || '-' %>
                <% end %>
              </td>
              <% if policy([ current_user_role_group, site_visit]).show_channel_partner? %>
                <td>
                  <p class="fn-14 mt-1 mb-0">
                    <%= link_to_if (policy([:admin, User]).index? && site_visit.manager_name.present? && current_user.role.in?(User::ALL_PROJECT_ACCESS)), (site_visit.manager_name || "-"), [current_user_role_group, site_visit.manager], class: 'theme-txt-color' %>
                  </p>
                </td>
              <% end %>
              <td>
                <p class="font-medium fn-12 mb-0 d-inline-block me-2"><i
                    class="fa fa-circle info me-2 fa-sm"></i><%= t("mongoid.attributes.site_visit/status.#{site_visit.status}") || '-' %>
                </p>
              </td>
              <td>
                <%= I18n.l(site_visit.scheduled_on) || '-' %>
              </td>
              <td>
                <%= link_to_if policy([current_user_role_group, site_visit.project]).show?, site_visit.project_name, [current_user_role_group, site_visit.project], class: 'theme-txt-color' %>
              </td>
              <td>
                <% unless site_visit.verification_pending? %>
                <i
                  class='fa fn-16 fa-<%= site_visit.verification_approved? ? "check" : "times" %> fill-<%= site_visit.verification_approved? ? "success" : "danger" %> me-12 fa-lg'></i>
                <% end %>
                <%= t("mongoid.attributes.site_visit/approval_status.#{site_visit.approval_status}") %>
              </td>
              <td>
                <% if site_visit.cp_manager.present? && ["cp_admin","admin","superadmin"].include?(current_user.role) %>
                <span><%= link_to(site_visit.cp_manager.name, admin_user_path(site_visit.cp_manager), class: "theme-txt-color col-title") %></span>
                <% end %>
              </td>
              <td>
                <a href="javascript:void(0);" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false">
                  <i class="fa fa-ellipsis-v txt-light-blue" aria-hidden="true"></i></a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                  <%= render "#{current_user_role_group}/site_visits/links", site_visit: site_visit %>
                </div>
              </td>

            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <!----------- Pagination ---------->
      <% if site_visits.is_a? WillPaginate::Collection %>
      <div class="col-lg-12 py-3 bg-white mb-2 px-3 mt-3 shadow-sm">
        <div class="row">
          <div class="col-lg-6 pt-2">
            <p class="table-entry mb-0"><%= page_entries_info site_visits %></p>
          </div>
          <div class="col-lg-6 table-pagination">
            <%= will_paginate site_visits, list_classes: %w(pagination justify-content-end) %>
          </div>
        </div>
      </div>
      <% end %>
    </div>
  </div>
</section>
