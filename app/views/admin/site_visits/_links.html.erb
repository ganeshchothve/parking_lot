<% if policy([:admin, site_visit]).show? %>
  <%= link_to t('controller.site_visits.show.link_name'), admin_site_visit_path(site_visit.id), class: "dropdown-item" %>
<% end %>
<% if policy([:admin, site_visit]).sync_with_selldo? %>
  <%= link_to t('controller.site_visits.sync_with_selldo.link_name'), sync_with_selldo_admin_site_visit_path(site_visit.id), class: "dropdown-item" %>
<% end %>
<% if policy([:admin, site_visit]).edit? && policy([:admin, site_visit]).editable_field?('scheduled_on') %>
  <%= link_to t('controller.site_visits.edit.link_name'), edit_admin_site_visit_path(site_visit.id), class: "dropdown-item modal-remote-form-link" %>
<% end %>
<% if policy([current_user_role_group, site_visit]).change_state? && policy([current_user_role_group, site_visit]).editable_field?('event') %>
  <% site_visit.aasm(:status).events(permitted: true).each do |event| %>
    <%= link_to t("controller.site_visits.events.status.#{event.name}"), change_state_admin_site_visit_path(site_visit, {site_visit: {event: event.name}}), method: :patch, class: 'dropdown-item' %>
  <% end %>
<% end %>
<% if policy([current_user_role_group, site_visit]).change_state? && policy([current_user_role_group, site_visit]).editable_field?('approval_event') %>
  <% site_visit.aasm(:approval_status).events(permitted: true).each do |event| %>
    <% if event.name.to_s == 'reject' %>
      <%= link_to t("controller.site_visits.events.approval_status.#{event.name}"), reject_admin_site_visit_path(site_visit), class: 'dropdown-item modal-remote-form-link' %>
    <% else %>
      <%= link_to t("controller.site_visits.events.approval_status.#{event.name}"), change_state_admin_site_visit_path(site_visit, {site_visit: {approval_event: event.name}}), method: :patch, class: 'dropdown-item' %>
    <% end %>
  <% end %>
<% end %>

<%= render 'admin/invoices/invoiceable_links', resource: site_visit %>

<% if policy([:admin, Note.new(notable: site_visit)]).new? %>
  <%= link_to t('helpers.new.link_name', model: Note.model_name.human), new_notable_path(notable_type: site_visit.class.model_name.i18n_key.to_s, notable_id: site_visit.id), class: "dropdown-item modal-remote-form-link" %>
<% end %>

