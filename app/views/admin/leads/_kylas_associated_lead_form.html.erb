<% 
  kylas_products = {}
  kylas_products['Deal Product'] = @deal_associated_products if @deal_associated_products.present?
  kylas_products['Other Products'] = (@kylas_products | @deal_associated_products) - (@kylas_products & @deal_associated_products) if @kylas_products.present?
%>

<%= f.hidden_field :kylas_deal_id, value: @lead.kylas_deal_id %>
<div class="mb-3">
    <%= f.label :kylas_product, class: 'label-required' %>
    <%= f.select :kylas_product_id, grouped_options_for_select(kylas_products), { include_blank: 'Select Kylas Product'}, autocomplete: 'off', class: 'selectize', required: true, disabled: !(policy([current_user_role_group, @lead]).editable_field?("project_id")) %>
</div>

<div class="mb-3">
    <%= f.label :kylas_contact, class: 'label-required' %>
    <%= f.select :kylas_contact_id, options_for_select(@deal_associated_contacts), { include_blank: 'Select Kylas Contact'}, autocomplete: 'off', class: 'selectize', required: true %>
</div>


<div class="mb-3">
  <%= f.label :first_name, class: 'label-required' %>
  <%= f.text_field :first_name, class: 'form-control', autofocus: true, required: true, readonly: true %>
</div>

<div class="mb-3">
  <%= f.label :last_name, class: 'label-required' %>
  <%= f.text_field :last_name, class: 'form-control', autofocus: true, required: true, readonly: true %>
</div>


  <div class="mb-3 hidden email-select">
    <%= f.label :email %>
    <%= f.select :email, options_for_select([]), { include_blank: 'Select Kylas Email'}, autocomplete: 'off', class: 'selectize email_select', disabled: true, hidden: true %>
  </div>

  <div class="mb-3 hidden email-text">
    <%= f.label :email %>
    <%= f.email_field :email, class: 'form-control', id: 'new_lead_email', disabled: true, hidden: true %>
  </div>
  <%= f.hidden_field :email_update, value: true, disabled: true %>



  <div class="mb-3 hidden phone-select">
    <%= f.label :phone %>
    <%= f.select :phone, options_for_select([]),  { include_blank: 'Select Kylas Phone'}, autocomplete: 'off', class: 'selectize phone_select', disabled: true, hidden: true %>
  </div>

  <div class="mb-3 hidden phone-text">
    <%= f.label :phone, class: 'form-label' %>
    <%= f.text_field :phone, class: 'form-control phone', id: 'new_lead_phone', disabled: true, hidden: true %>
  </div>
  <%= f.hidden_field :phone_update, value: true, disabled: true %>



<% if (policy([current_user_role_group, @lead]).editable_field?("manager_id")) %>
  <div class="mb-3">
    <%= f.label :manager_id %>
    <%= f.select :manager_id, options_from_collection_for_select(@cp_users.present? ? @cp_users : [], "id" , "name", ((@cp_users.first.id.to_s rescue nil))), {prompt: true }, class: 'selectize-remote', data: { url: admin_users_path, params: { fltrs: { role: ['channel_partner', 'cp_owner' ], user_status_in_company: 'active' } } }%>
  </div>
<% end %>

<div class="text-end">
    <%= f.submit "Save", class: 'btn btn-primary float-end w-auto border-primary' %>
</div>
