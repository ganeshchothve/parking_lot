<%= form_for([:admin, @scheme], local: true, remote: true, html: {class: 'modal-remote-form validate-form', "data-resource-type": global_labels['schemes'], "data-type": "json", id: 'scheme_form'}) do |f| %>
<div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><%= @scheme.new_record? ? "New" : "Edit" %> <%= "#{global_labels['scheme']}" %></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <%= f.label :name, class: 'label-required' %>
          <%= f.text_field :name, autofocus: true, class: "form-control", required: 'required', disabled: (policy(@scheme).editable_field?("name") ? false : true) %>
        </div>
        <div class="form-group">
          <%= f.label :project_unit_id, class: 'control-label' %>
          <%= f.select :project_unit_id, f.object.project_unit_id.present? ? [[f.object.project_unit.name, f.object.project_unit.id]] : [], {prompt: true}, class: 'selectize-remote', disabled: (policy(@scheme).editable_field?("project_unit_id") ? false : true), "data-url": admin_project_units_path, "data-params": {fltrs: {status: {"$in": ['available', 'management', 'employee']}}}.to_json, 'data-ds': 'ds' %>
        </div>
        <div class="form-group">
          <%= f.label :user_role, class: 'control-label' %>
          <%= f.select :user_role, User.available_roles(current_client).select{|x| User.buyer_roles(current_client).include?(x[:id])}.collect{|x| [x[:text], x[:id]] }, {prompt: true}, class: 'selectize', disabled: (policy(@scheme).editable_field?("user_role") ? false : true) %>
        </div>
        <div class="form-group">
          <%= f.label :user_id, class: 'control-label' %>
          <%= f.select :user_id, f.object.user_id.present? ? [[f.object.user.name, f.object.user.id]] : [], {prompt: true}, class: 'selectize-remote', disabled: (policy(@scheme).editable_field?("user_id") ? false : true), "data-url": admin_users_path, "data-params": {fltrs: {role: {"$in": User.buyer_roles(current_client) }}}.to_json, 'data-ds': 'ds' %>
        </div>
        <div class="form-group">
          <%= f.label :value, class: 'label-required' %>
          <%= f.number_field :value, class: "form-control", required: 'required', disabled: (policy(@scheme).editable_field?("value") ? false : true) %>
          <p class="small text-muted">Total Adjustment will be calculated as Rs. (saleable) * (scheme mentioned here)</p>
        </div>
        <% if policy(@scheme).editable_field?("status") %>
          <div class="form-group">
            <%= f.label :status, class: 'label-required' %>
            <%
              if @scheme.new_record?
                statuses = Scheme.available_statuses.select{|x| x[:id] == 'draft' }
              elsif @scheme.status == 'approved' || @scheme.status == 'disabled'
                statuses = Scheme.available_statuses.select{|x| ['disabled', 'approved'].include?(x[:id]) }
              else
                statuses = Scheme.available_statuses
              end
              statuses = statuses.collect{|x| [x[:text], x[:id]] }
            %>
            <%= f.select :status, statuses, {prompt: true}, class: 'selectize', required: "required" %>
          </div>
        <% end %>
      </div>
      <div class="modal-footer">
        <%= f.submit "Save", class: "btn btn-primary" %>
      </div>
    </div>
  </div>
</div>
<% end %>
<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($("#scheme_form"));
});
<% end %>
