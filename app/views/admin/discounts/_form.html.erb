<%= render 'breadcrumbs', {discount: @discount} %>
<section class="padding-side-22">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 text-left mtop10">
          <p class="pageTitle big pink">DISCOUNT</p>
      </div>
      <div class="col-md-12 border-left-0 border-top-0 border-bottom-0">
        <% if @discount.errors.present? %>
        <div class="alert alert-danger">
          <ul>
            <% @discount.errors.full_messages.each do |message| %>
            <li><%= message %></li>
            <% end %>
          </ul>
        </div>
        <% end %>
        <%= form_for [:admin, @discount], html: {class: 'validate-form'} do |f| %>
          <div class="form-group">
            <%= f.label :name, class: 'control-label label-required' %>
            <%= f.text_field :name, autofocus: true, class: "form-control", required: 'required', disabled: (policy(@discount).editable_field?("name") ? false : true) %>
          </div>
          <div class="form-group">
            <%= f.label :project_unit_id, class: 'control-label' %>
            <%= f.select :project_unit_id, f.object.project_unit_id.present? ? [[f.object.project_unit.name, f.object.project_unit.id]] : [], {prompt: true}, class: 'selectize-remote', disabled: (policy(@discount).editable_field?("project_unit_id") ? false : true), "data-url": admin_project_units_path, "data-params": {fltrs: {status: {"$in": ['available', 'management', 'employee']}}}.to_json, 'data-ds': 'ds' %>
          </div>
          <div class="form-group">
            <%= f.label :user_role, class: 'control-label' %>
            <%= f.select :user_role, User.available_roles.select{|x| User.buyer_roles.include?(x[:id])}.collect{|x| [x[:text], x[:id]] }, {prompt: true}, class: 'selectize', disabled: (policy(@discount).editable_field?("user_role") ? false : true) %>
          </div>
          <div class="form-group">
            <%= f.label :user_id, class: 'control-label' %>
            <%= f.select :user_id, f.object.user_id.present? ? [[f.object.user.name, f.object.user.id]] : [], {prompt: true}, class: 'selectize-remote', disabled: (policy(@discount).editable_field?("user_id") ? false : true), "data-url": admin_users_path, "data-params": {fltrs: {role: {"$in": User.buyer_roles }}}.to_json, 'data-ds': 'ds' %>
          </div>
          <div class="form-group">
            <%= f.label :value, class: 'control-label label-required' %>
            <%= f.number_field :value, class: "form-control", required: 'required', disabled: (policy(@discount).editable_field?("value") ? false : true) %>
          </div>
          <% if policy(@discount).editable_field?("status") %>
            <div class="form-group">
              <%= f.label :status, class: 'control-label label-required' %>
              <%
                if @discount.new_record?
                  statuses = Discount.available_statuses.select{|x| x[:id] == 'draft' }
                elsif @discount.status == 'approved' || @discount.status == 'disabled'
                  statuses = Discount.available_statuses.select{|x| ['disabled', 'approved'].include?(x[:id]) }
                else
                  statuses = Discount.available_statuses
                end
                statuses = statuses.collect{|x| [x[:text], x[:id]] }
              %>
              <%= f.select :status, statuses, {prompt: true}, class: 'selectize', required: "required" %>
            </div>
          <% end %>
          <div class="form-group">
            <%= f.submit "Submit", class: 'btn btn-primary pink-btn' %>
          </div>
        <% end %>
        <%= javascript_tag do %>
        $(document).ready(function(){
          FormInitializer.init($('.validate-form'));
        });
        <% end %>
      </div>
      <div class="col-md-4">
      </div>
    </div>
  </div>
</section>
