<!-- Show Details Page -->
<%= link_to t('controller.invoices.show.link_name'), admin_invoice_path(invoice), class: 'dropdown-item' %>
<!-- Raise invoice for channel partner -->
<% if policy([current_user_role_group, invoice]).change_state? && policy([current_user_role_group, invoice]).editable_field?('event') %>
  <% invoice.aasm.events(permitted: true).each do |event| %>
    <% if event.name == :raise %>
      <%= link_to t("controller.invoices.events.#{event.name}"), raise_invoice_admin_invoiceable_path(invoice, invoiceable_type: invoice.invoiceable_type, invoiceable_id: invoice.invoiceable_id), class: 'dropdown-item modal-remote-form-link', data: { disable_with: I18n.t("global.please_wait") }  %>
    <%# else %>
      <%#= link_to t("controller.invoices.events.#{event.name}"), change_state_admin_invoiceable_path(invoice, invoiceable_type: resource.class.model_name.i18n_key.to_s, invoiceable_id: resource.id, {invoice: {event: event.name}}), method: :patch, class: 'dropdown-item' %>
    <% end %>
  <% end %>
<% end %>

<!-- Edit invoice for Billing Team -->
<% if policy([current_user_role_group, invoice]).edit? %>
  <%= link_to t("controller.invoices.edit.link_name"), edit_admin_invoice_path(invoice), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if policy([current_user_role_group, invoice]).move_tentative_to_draft? %>
  <% if invoice._type == "Invoice::Manual" %>
    <%= link_to I18n.t("controller.invoices.move_to_draft.link_name"), change_state_admin_invoiceable_path(invoice, invoiceable_type: invoice.invoiceable_type , invoiceable_id: invoice.invoiceable_id, invoice_manual: {event: :draft}), method: :patch, class: 'dropdown-item' %>
  <% else %>
    <%= link_to I18n.t("controller.invoices.move_to_draft.link_name"), change_state_admin_invoiceable_path(invoice, invoiceable_type: invoice.invoiceable_type , invoiceable_id: invoice.invoiceable_id, invoice_calculated: {event: :draft}), method: :patch, class: 'dropdown-item' %>
  <% end %>
<% end %>

<% if policy([current_user_role_group, invoice]).choose_template_for_print? %>
  <%= link_to t('controller.templates.choose_template_for_print.link_name'), choose_template_for_print_admin_custom_templates_path(subject_class: invoice.class.model_name.i18n_key.to_s, subject_class_id: invoice.id.to_s), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<!-- Update GST amount -->
<%# if policy([current_user_role_group, invoice]).update_gst? %>
  <%#= link_to t("controller.invoices.update_gst.link_name"), update_gst_admin_invoice_path(invoice), class: 'dropdown-item modal-remote-form-link' %>
<%# end %>

<% if policy([current_user_role_group, invoice]).generate_invoice? %>
  <%= link_to t("controller.invoices.generate_invoice.link_name"), generate_invoice_admin_invoice_path(invoice), class: 'dropdown-item', target: '_blank' %>
<% end %>
<% if policy([current_user_role_group, invoice]).new_send_invoice_to_poc? %>
  <%= link_to I18n.t("controller.invoices.send_invoice.link_name"), new_send_invoice_to_poc_admin_invoice_path(invoice), class: 'dropdown-item modal-remote-form-link', target: '_blank' %>
<% end %>

<!-- Raise incentive deduction for cp_admin -->
<% incentive_deduction = IncentiveDeduction.where(booking_portal_client_id: current_client.try(:id), invoice_id: invoice.id).first %>
<% if incentive_deduction.blank? %>
  <% if policy([current_user_role_group, invoice.build_incentive_deduction]).create? %>
    <%= link_to t("controller.incentive_deductions.new.link_name"), new_admin_invoice_incentive_deduction_path(invoice), class: 'dropdown-item modal-remote-form-link' %>
  <% end %>
<% else %>
  <% if policy([current_user_role_group, incentive_deduction]).edit? %>
    <%= link_to t("controller.incentive_deductions.edit.link_name"), edit_admin_invoice_incentive_deduction_path(invoice, incentive_deduction), class: 'dropdown-item modal-remote-form-link' %>
  <% end %>
  <% if policy([current_user_role_group, incentive_deduction]).show? %>
    <%= link_to t("controller.incentive_deductions.show.link_name"), admin_invoice_incentive_deduction_path(invoice, incentive_deduction), class: 'dropdown-item modal-remote-form-link' %>
  <% end %>
<% end %>

<!-- Upload documents for channel partner -->
<% if policy([:admin, invoice]).index? %>
  <% link_name = policy([:admin, invoice]).asset_create? ? t('controller.invoices.asset_create.link_name') : t('controller.invoices.asset_show.link_name') %>
  <%= link_to link_name, assetables_path(assetable_type: invoice.class.model_name.i18n_key.to_s, assetable_id: invoice.id, asset_header: link_name), class: "dropdown-item modal-remote-form-link" %>
<% end %>
