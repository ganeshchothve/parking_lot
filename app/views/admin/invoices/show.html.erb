<div class="container mb-5">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <div class="box-card">
        <div class="box-header bg-gradient br-rd-tr-4">
          <h2 class="icon-set icon-file-kycs-white"><%= t('mongoid.attributes.invoice.number') + @invoice.number %></h2>
        </div>
        <div class="box-content br-rd-bl-4 bg-white p-0 pt-1">
          <div class="pd-box">
            <% invoice_labels = t("mongoid.attributes.invoice").with_indifferent_access %>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label class="small text-muted"><%= invoice_labels[:project_id] %></label>
                  <div><%= @invoice.project.name %></div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label class="small text-muted"><%= invoice_labels[:booking_detail_id] %></label>
                  <div><%= link_to @invoice.booking_detail.name, [current_user_role_group, @invoice.booking_detail] %></div>
                </div>
              </div>
              <% unless current_user.role?('channel_partner') %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= ChannelPartner.model_name.human %></label>
                    <div><%= link_to_if policy([current_user_role_group, @invoice.manager]).index?, @invoice.manager_name, [:admin, @invoice.manager] %></div>
                  </div>
                </div>
              <% end %>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label class="small text-muted"><%= invoice_labels[:incentive_scheme_id] %></label>
                  <div><%= @invoice.incentive_scheme.name %></div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label class="small text-muted"><%= invoice_labels[:ladder_stage] %></label>
                  <div>
                    <span class='mr-2'><%= @invoice.ladder_stage %></span>
                    <% if adj = @invoice.incentive_scheme.ladders.where(stage: @invoice.ladder_stage).first.try(:payment_adjustment).presence %>
                      <% if adj.absolute_value.blank? && adj.formula.present? %>
                        <span>(<%= formula_to_human(adj.formula) %>)<span>
                      <% else %>
                        <span>(<strong><%= number_to_indian_currency(adj.absolute_value) %></strong>)</span>
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label class="small text-muted"><%= invoice_labels[:amount] %></label>
                  <div><%= number_to_indian_currency(@invoice.amount) %></div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label class="small text-muted"><%= invoice_labels[:status] %></label>
                  <div><%= t("mongoid.attributes.invoice/status.#{@invoice.status}") %></div>
                </div>
              </div>
              <% if @invoice.approved? %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= invoice_labels[:net_amount] %></label>
                    <div><%= number_to_indian_currency(@invoice.net_amount) %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.raised_date.present? %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= invoice_labels[:raised_date] %></label>
                    <div><%= @invoice.raised_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.processing_date.present? %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= invoice_labels[:processing_date] %></label>
                    <div><%= @invoice.processing_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.approved_date.present? %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= invoice_labels[:approved_date] %></label>
                    <div><%= @invoice.approved_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.rejection_reason.present? %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= invoice_labels[:rejection_reason] %></label>
                    <div class='break-word'><%= @invoice.rejection_reason %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.comments.present? %>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="small text-muted"><%= invoice_labels[:comments] %></label>
                    <div class='break-word'><%= @invoice.comments %></div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
