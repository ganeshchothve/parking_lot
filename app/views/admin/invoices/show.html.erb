<div class="mb-5 mt-3">
  <div class="px-4">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <div class="box-card">
        <div class="box-header bg-gradient br-rd-tr-4">
          <h2 class="icon-set icon-file-kycs-white"><%= "#{Invoice.model_name.human} #{@invoice.try(:number)}" %></h2>
        </div>
        <div class="box-content br-rd-bl-4 bg-white p-0 pt-1">
          <div class="pd-box">
            <% invoice_labels = t("mongoid.attributes.invoice").with_indifferent_access %>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%= invoice_labels[:project_id] %></label>
                  <div><%= @invoice.project.name %></div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%= invoice_labels[:booking_detail_id] %></label>
                  <div><%= link_to @invoice.booking_detail.name, [current_user_role_group, @invoice.booking_detail] %></div>
                </div>
              </div>
              <% unless %w(channel_partner cp_owner).include?(current_user.role) %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <% user =  @invoice.try(:channel_partner).try(:users).try(:first) %>
                    <label class="small text-muted"><%= ChannelPartner.model_name.human %></label>
                    <div><%= "#{user.try(:name)} (#{user.try(:cp_code)})" %></div>
                  </div>
                </div>
              <% end %>
              <!--
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%#= invoice_labels[:incentive_scheme_id] %></label>
                  <div><%#= @invoice.incentive_scheme.name %></div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%#= invoice_labels[:ladder_stage] %></label>
                  <div>
                    <span class='mr-2'><%#= @invoice.ladder_stage %></span>
                    <%# if adj = @invoice.incentive_scheme.ladders.where(stage: @invoice.ladder_stage).first.try(:payment_adjustment).presence %>
                      <%# if adj.absolute_value.blank? && adj.formula.present? %>
                        <span>(<%#= formula_to_human(adj.formula) %>)<span>
                      <%# else %>
                        <span>(<strong><%#= number_to_indian_currency(adj.absolute_value) %></strong>)</span>
                      <%# end %>
                    <%# end %>
                  </div>
                </div>
              </div>
              -->
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%= invoice_labels[:status] %></label>
                  <div><%= t("mongoid.attributes.invoice/status.#{@invoice.status}") %></div>
                </div>
              </div>
              <% if @invoice.raised_date.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= invoice_labels[:raised_date] %></label>
                    <div><%= @invoice.raised_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.processing_date.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= invoice_labels[:processing_date] %></label>
                    <div><%= @invoice.processing_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.approved_date.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= invoice_labels[:approved_date] %></label>
                    <div><%= @invoice.approved_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.rejection_reason.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= invoice_labels[:rejection_reason] %></label>
                    <div class='break-word'><%= @invoice.rejection_reason %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.comments.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= invoice_labels[:comments] %></label>
                    <div class='break-word'><%= @invoice.comments %></div>
                  </div>
                </div>
              <% end %>
            </div>
            <hr>
            <% cheque_detail = @invoice.cheque_detail %>
            <% if cheque_detail.present?
              cheque_labels = t("mongoid.attributes.cheque_detail").with_indifferent_access
            %>
              <h4><%= invoice_labels[:cheque_detail] %></h4>
              <div class="row">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= cheque_labels[:total_amount] %></label>
                    <div class='break-word'><%= number_to_indian_currency(cheque_detail.total_amount) %></div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= cheque_labels[:issuing_bank] %></label>
                    <div class='break-word'><%= cheque_detail.issuing_bank %></div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= cheque_labels[:issuing_bank_branch] %></label>
                    <div class='break-word'><%= cheque_detail.issuing_bank_branch %></div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= cheque_labels[:issued_date] %></label>
                    <div class='break-word'><%= cheque_detail.issued_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') rescue '' %></div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= cheque_labels[:handover_date] %></label>
                    <div class='break-word'><%= cheque_detail.handover_date.in_time_zone(current_user.time_zone).strftime('%d/%m/%Y %H:%M') rescue '' %></div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= cheque_labels[:payment_identifier] %></label>
                    <div class='break-word'><%= cheque_detail.payment_identifier %></div>
                  </div>
                </div>
              </div>
              <hr>
            <% end %>
            <h4>Amount</h4>
            <div class='row'>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%= invoice_labels[:amount] %></label>
                  <div><%= number_to_indian_currency(@invoice.amount) %></div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="small text-muted"><%= invoice_labels[:gst_amount] %></label>
                  <div><%= number_to_indian_currency(@invoice.gst_amount) %></div>
                </div>
              </div>
              <% if @invoice.payment_adjustment.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted">Adjustment</label>
                    <div><%= number_to_indian_currency(@invoice.payment_adjustment.try(:absolute_value).to_f) %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.incentive_deduction.present? && @invoice.incentive_deduction.approved? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= t('mongoid.attributes.incentive_deduction.amount') %></label>
                    <div><%= number_to_indian_currency(@invoice.incentive_deduction.try(:amount).to_f) %></div>
                  </div>
                </div>
              <% end %>
              <% if @invoice.status.in?(%w(approved paid)) && @invoice.net_amount.present? %>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="small text-muted"><%= invoice_labels[:net_amount] %></label>
                    <div><%= number_to_indian_currency(@invoice.net_amount) %></div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
