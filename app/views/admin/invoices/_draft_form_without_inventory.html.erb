<%= nested_form_for([:admin, @booking_detail, @invoice], url: url, local: true, remote: true, html: {class: 'modal-remote-form validate-form', "data-resource-type": global_labels['invoices'], "data-type": "json", id: 'invoice_form'}) do |f| %>
<div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="title"><%= t("controller.invoices.#{action_name}.link_name") %></h3>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body theme-form">
        <div class="mb-3">
          <%= f.label :number, class: 'label-required' %>
          <%= f.text_field :number, autofocus: true, required: 'required', class: "form-control", disabled: !policy([:admin, @invoice]).editable_field?("number") %>
        </div>
        <div class="mb-3">
          <%= f.label :gst_slab, class: 'control-label label-required' %>
          <% gst_slabs = @booking_detail.project.incentive_gst_slabs%>
          <%= f.select :gst_slab, options_for_select(gst_slabs.collect{|gst| [ gst, gst]}), class: 'selectize', required: 'required', disabled: !policy([:admin, @invoice]).editable_field?("gst_slab") %>
        </div>
        <% if policy([:admin, @invoice]).editable_field?("event") && !current_user.role?('channel_partner') %>
          <div class="mb-3">
            <%= f.label :status, class: 'control-label label-required' %>
            <% events = available_events(@invoice) %>
            <%= f.select :event, options_for_select(events.collect{|event| [t("controller.invoices.events.#{event.to_s}"), event.to_s]}, @invoice.status), {prompt: t("mongoid.attributes.invoice/status.#{@invoice.status}")}, class: 'selectize', required: 'required', disabled: !policy([:admin, @invoice]).editable_field?("event") %>
          </div>
        <% end %>
        <% if @invoice.rejected? || @invoice.rejection_reason.present? %>
          <div class="mb-3">
            <%= f.label :rejection_reason, class: '' %>
            <% if policy([:admin, @invoice]).editable_field?("rejection_reason") %>
              <%= f.text_area :rejection_reason, autofocus: true, class: "form-control", disabled: !policy([:admin, @invoice]).editable_field?("rejection_reason") %>
            <% else %>
              <p><%= f.object.rejection_reason %></p>
            <% end%>
          </div>
          <div class="mb-3">
            <%= f.label :comments, class: '' %>
            <% if policy([:admin, @invoice]).editable_field?("comments") %>
              <%= f.text_area :comments, autofocus: true, class: "form-control", disabled: !policy([:admin, @invoice]).editable_field?("comments") %>
            <% else %>
              <p><%= f.object.comments %></p>
            <% end%>
          </div>
        <% end %>
      </div>

      <div class="modal-footer text-end">
        <%= f.submit 'Save', class: "btn btn-primary" %>
      </div>

    </div>
  </div>
</div>
<% end %>
<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($("#invoice_form"));
  var netAmt = <%= @invoice.net_amount %>
  $('#invoice_form').find('.net-amount').html(Amura.formatMoney(netAmt));

  $('#invoice_form').find('input[name="invoice[gst_amount]"],input[name="invoice[amount]"]').on('blur', function(event) {
    $('#invoice_form').find('.net-amount').html(
      Amura.formatMoney(
        parseFloat($('input[name="invoice[gst_amount]"]').val() || 0) +
        parseFloat($('input[name="invoice[amount]"]').val() || 0)
      )
    );
  });
});
<% end %>
