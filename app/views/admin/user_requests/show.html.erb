<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <%= render 'admin/user_requests/detail', user_request: @user_request %>
      <div class="mt-3"></div>
    </div>
  </div>
  <% if @user_request.requestable.kind_of?(BookingDetail) %>
    <div class="row">
      <div class="col">
        <%= render 'dashboard/booking_detail_overview', {booking_detail: @user_request.requestable, with_actions: true }  %>
      </div>
      <% if @user_request._type == "UserRequest::Swap" && @user_request.resolved? %>
        <% if @user_request.alternate_project_unit.booking_detail.present? %>
          <div class="col">
            <%= render 'dashboard/booking_detail_overview', {booking_detail: @user_request.alternate_project_unit.booking_detail, with_actions: true } %>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="mt-3"></div>
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header">
            <h5> Payment Details</h5>
          </div>
            <div class="card-body">
              <%= render 'receipts/index', {receipts: @user_request.requestable.receipts.paginate(page:1, per_page: 1000)} if @user_request.requestable.kind_of?(BookingDetail) %>
            </div>
          </div>
        </div>
      <% if @user_request._type == "UserRequest::Swap" && @user_request.resolved? %>
        <div class="col">
          <div class="card">
            <div class="card-header">
            <h5> Payment Details</h5>
            </div>
            <div class="card-body">
              <%= render 'receipts/index', {receipts: @user_request.alternate_project_unit.booking_detail.receipts.paginate(page: 1, per_page: 1000)} %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% elsif @user_request.requestable.kind_of?(Receipt) %>
    <div class="table-responsive card">
      <table class="striped-table table">
        <thead class="th-default">
          <% labels = t('mongoid.attributes.receipt').with_indifferent_access %>
          <% user_labels = t('mongoid.attributes.user').with_indifferent_access %>
          <tr>
            <th><%= labels[:user_id] %></th>
            <th><%= labels[:receipt_id] %> & Details</th>
            <% if current_client.enable_slot_generation? %>
              <th>Token Number</th>
            <% end %>
            <th><%= labels['status'] %></th>
            <th class="text-right"><%= labels['total_amount'] %></th>
            <th class="text-right"></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <% if policy([current_user_role_group, @receipt.user]).show? %>
                <%= link_to @receipt.user.name, [current_user_role_group, @receipt.user] %>
              <% else %>
                <%= @receipt.user.name %>
              <% end %>
              <div class="small">
                Created By: <%= @receipt.creator.name %><br/>
                <% if @receipt.user.role?("user") && @receipt.user.manager_id.present? && current_user.role != "channel_partner" %>
                  <%= user_labels[:manager_id] %>: <%= @receipt.user.manager.name %><br/>
                <% end %>
              </div>
            </td>
            <td>
              <%= ["success", "available_for_refund", "refunded", "cancelled"].include?(@receipt.status) ? @receipt.receipt_id : "Not Generated" %>
              <div class="small muted">
                <div>
                  <%= @receipt.booking_detail.present? ? "Unit: #{@receipt.booking_detail.name}" : 'Direct Payment' %>
                </div>
                <% if @receipt.payment_mode == 'online' %>
                  <div>Trans ID: <%= @receipt.payment_identifier %></div>
                  <div>Processed Date:<%= @receipt.processed_on.present? ? l(@receipt.processed_on) : "-" %></div>
                <% else %>
                  <div>Bank: <%= @receipt.issuing_bank %> / Branch: <%= @receipt.issuing_bank_branch %></div>
                  <div>Issued Date: <%= @receipt.issued_date.present? ? @receipt.issued_date.strftime("%d/%m/%Y") : "-" %></div>
                  <div>Processed Date: <%= @receipt.processed_on.present? ? l(@receipt.processed_on) : "-" %></div>
                  <div>ID: <%= @receipt.payment_identifier %></div>
                <% end %>
                <div>Payment: <%= Receipt.available_payment_modes.find{|x| x[:id] == @receipt.payment_mode}[:text] %></div>
              </div>
            </td>
            <td><%= @receipt.status.titleize %></td>
            <td class="text-right"><%= number_to_indian_currency(@receipt.total_amount.round) %></td>
          </tr>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
