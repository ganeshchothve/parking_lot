<%
  hash = {"data-resource-type": global_labels['user_request'], "data-type": "json"}
  hash = {confirm: 'Are you sure you want to proceed?'} if @user_request.new_record? && current_user.buyer?
%>
<%
  if current_user.buyer?
    url = user_user_requests_path(request_type: @user_request.class.model_name.element)
  else
    if @user_request.new_record?
      url = admin_user_user_requests_path(user_id: @user_request.user_id, request_type: @user_request.class.model_name.element)
    else
      url = admin_user_user_request_path(user_id: @user_request.user_id, request_type: @user_request.class.model_name.element, id: @user_request.id)
    end
  end
%>
<%= form_for @user_request, url: url, remote: true, html: {class: 'modal-remote-form validate-form'}, data: hash do |f| %>
<div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><%= @user_request.new_record? ? "New" : "Edit" %> <%= "#{global_labels['user_request']}" %></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <% if policy(@user_request).editable_field?("project_unit_id") %>
          <div class="form-group">
            <%= f.label :project_unit_id, class: 'label-required' %>
            <%= f.select :project_unit_id, @user_request.user.project_units.collect{|x| [x.name, x.id] }, {prompt: true}, class: 'selectize', disabled: (policy(@user_request).editable_field?("project_unit_id") ? false : true), required: "required" %>
          </div>
        <% else %>
          <div class="form-group">
            <%= f.label :project_unit_id, class: 'label-required' %>
            <div><%= @user_request.project_unit.name %></div>
          </div>
        <% end %>
        <% begin %>
          <%= render "admin/user_requests/#{@user_request.class.model_name.element}", f: f %>
          <hr/>
        <% rescue ActionView::MissingTemplate %>
        <% end %>

        <% if policy(@user_request).editable_field?("status") %>
          <div class="form-group">
            <%= f.label :status, class: 'label-required' %>
            <%= f.select :status, UserRequest.available_statuses.collect{|x| [x[:text], x[:id]]}, {prompt: true}, class: 'selectize', required: "required" %>
          </div>
        <% else %>
          <div>
            Status: <%= f.object.status %>
          </div>
        <% end %>
        <% if policy(@user_request).editable_field?("notes_attributes") %>
          <% f.object.notes.new(creator_id: current_user.id) %>
          <%= f.fields_for :notes do |note|%>
            <div class="form-group">
              <%= note.label :comments, class: 'label-required' %>
              <%= note.text_area :note, autofocus: true, class: "form-control", required: 'required' %>
              <%= note.hidden_field :creator_id %>
            </div>
          <% end %>
        <% end %>
        <% if @user_request.new_record? %>
          <div class="form-group">
            <div class="alert alert-primary">
              Your unit will be released once the cancellation request is processed. For booking the same unit again, you will have to go through the selection process again which will also be subject to availability.<br/>
              <div class="form-check mt-3">
                <input type="checkbox" id="accepted" class="form-check-input" />
                <label class="form-check-label">I Agree <%= @user_request.user_id == current_user.id ? "" : " on behalf of #{@user_request.user.name}" %></label>
              </div>
            </div>
          </div>
          <% end %>
      </div>
      <div class="modal-footer">
        <%= f.submit "Submit", class: 'btn btn-primary', disabled: (@user_request.new_record? ? true : false), id: "submit_request", data:{event_category: 'Section', event_action: 'Click', event_name: 'cancel booking - submit'}  %>
      </div>
    </div>
  </div>
</div>
<% end %>
<%= javascript_tag do %>
$(document).ready(function(){
  FormInitializer.init($('.validate-form'));
  $("#accepted").change(function(){
    if($(this).is(":checked")){
      $("#submit_request").removeAttr("disabled");
    }else{
      $("#submit_request").attr("disabled", "disabled");
    }
  })
});
<% end %>
