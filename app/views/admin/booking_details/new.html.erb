<%= form_for([:admin, @booking_detail], local: true, remote: true, html: {class: 'modal-remote-form validate-form', "data-resource-type": global_labels['schemes'], "data-type": "json", id: 'booking_detail_form'}) do |f| %>
<div class="modal fade right fixed-header-footer" role="dialog" id="modal-remote-form-inner">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><%= @booking_detail.new_record? ? "New" : "Edit" %> <%= "#{global_labels['booking_detail']}" %></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <%= f.label :user_id, class: 'control-label' %>
          <%= f.select :user_id, options_from_collection_for_select(User.where(_id: f.object.user_id), 'id', 'name', f.object.user_id), {prompt: true }, class: 'selectize-remote', required: 'required', autofocus: true, data: { url: admin_users_path, params: {role: 'customer'} }%>
        </div>
        <div class="form-group">
          <%= f.label :primary_user_kyc_id, class: 'control-label' %>
          <%= f.select :primary_user_kyc_id, options_from_collection_for_select(UserKyc.where(_id: f.object.primary_user_kyc_id), 'id', 'name', f.object.primary_user_kyc_id), {prompt: true }, class: 'selectize-remote', required: 'required', autofocus: true, data: { url: admin_user_kycs_url, params: { fltrs: {user_id: User.find_by(user_kyc_id: f.object.primary_user_kyc_id).id } } } %>
        </div>
        <div class="form-group">
          <%= f.label :project_tower_id, class: 'control-label' %>
          <%= select_tag "project_tower_id", options_for_select(ProjectTower.all.map{|f| [f.name, f.id]}), {prompt: "Select", class: "selectize"} %>
        </div>
        <div class="form-group">
          <%= f.label :project_unit_id, class: 'control-label' %>
          <%= f.select :project_unit_id, options_from_collection_for_select(ProjectUnit.where(_id: f.object.project_unit_id), 'id', 'first_name', f.object.project_unit_id), {prompt: true }, class: 'selectize-remote', required: 'required', autofocus: true, data: { url: admin_project_units_path, params: { status: 'available', fltrs: {}} }%>
        </div>
      </div>
      <div class="modal-footer">
        <%= f.submit "Save", class: "btn btn-primary" %>
      </div>
    </div>
  </div>
</div>
<% end %>
<%= javascript_tag do %>
$(document).ready(function(){
  $('#booking_detail_user_id').change(function(){
    var $select = $("#booking_detail_primary_user_kyc_id").selectize();
    var selectize = $select[0].selectize;
    selectize.setValue('');
    selectize.clearOptions();
    var filter = $("#booking_detail_primary_user_kyc_id").data('params')
    filter.fltrs.user_id = $(this).val()
    $("#booking_detail_primary_user_kyc_id").data('params', filter)
  });
  $('#project_tower_id').change(function(){
    var $select = $("#booking_detail_project_unit_id").selectize();
    var selectize = $select[0].selectize;
    selectize.setValue('');
    selectize.clearOptions();
    var filter = $("#booking_detail_project_unit_id").data('params')
    filter.fltrs.project_tower_id = $(this).val()
    $("#booking_detail_project_tower_id").data('params', filter)
  });

  FormInitializer.init($("#booking_detail_form"));
});
<% end %>
