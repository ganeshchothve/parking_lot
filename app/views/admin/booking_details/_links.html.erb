<% if booking_detail.hold? && policy([:admin, booking_detail]).block? && booking_detail.search %>
  <%= link_to t('controller.booking_details.continue_booking.link_name'), checkout_lead_search_path(booking_detail.search), class: 'dropdown-item' %>
<% end %>

<% if policy([:admin, booking_detail]).send_payment_link? %>
  <%= link_to I18n.t('controller.users.send_payment_link'), send_payment_link_admin_lead_path(booking_detail.lead, {booking_detail_id: booking_detail.id.to_s}), class: "dropdown-item" %>
<% end %>

<% if policy([:admin, booking_detail]).show? && !(params[:controller] == 'admin/booking_details' && params[:action] == 'show') %>
  <%= link_to t('helpers.show.link_name', model: BookingDetail.model_name.human ), admin_booking_detail_path(booking_detail), class: 'dropdown-item' %>
<% end %>

<% if policy([:admin, booking_detail]).edit? %>
  <%= link_to t('helpers.edit.link_name', model: BookingDetail.model_name.human ), edit_admin_booking_detail_path(booking_detail), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if policy([:admin, booking_detail.lead]).show? %>
  <%= link_to t('helpers.show.link_name', model: Lead.model_name.human), admin_lead_path(booking_detail.lead), class: "dropdown-item" %>
<% end %>

<% if policy([:admin, booking_detail]).tasks? %>
  <%= link_to t('controller.booking_details.tasks.link_name'), tasks_admin_booking_detail_path(booking_detail), class: "dropdown-item modal-remote-form-link" %>
<% end %>

<%# if policy([:admin, Crm::Base.new()]).choose_crm? && Crm::Api.where(resource_class: 'BookingDetail').present? %>
  <%#= link_to t('controller.crms.choose_crm.link_name'), choose_crm_admin_crm_base_index_path(resource_id: booking_detail.id, resource_class: booking_detail.class), class: "dropdown-item " %>
<%# end %>

<% if booking_detail.scheme_rejected? && policy([:admin, booking_detail.project_unit]).release_unit? %>
  <%= link_to t('controller.booking_details.release_unit.link_name'), release_unit_admin_project_unit_path(booking_detail.project_unit), method: :patch, class: 'dropdown-item' %>
<% end %>

<% if policy([current_user_role_group, booking_detail]).generate_booking_detail_form? %>
  <%= link_to I18n.t('controller.booking_details.links.print_booking_form'), generate_booking_detail_form_admin_booking_detail_path(booking_detail), class: 'dropdown-item', target: '_blank' %>
<% end %>

<% if policy([current_user_role_group, booking_detail]).choose_template_for_print? %>
  <%= link_to t('controller.templates.choose_template_for_print.link_name'), choose_template_for_print_admin_custom_templates_path(subject_class: booking_detail.class.model_name.i18n_key.to_s, subject_class_id: booking_detail.id.to_s), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if policy([current_user_role_group, Asset.new(assetable: booking_detail) ]).update? %>
  <%= link_to t('controller.assets.index.link_name'), assetables_path(assetable_type: booking_detail.class.model_name.i18n_key.to_s, assetable_id: booking_detail.id), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if  policy([:admin, Receipt.new(user: booking_detail.user, lead: booking_detail.lead, booking_detail: booking_detail)]).lost_receipt? %>
  <%= link_to t('controller.receipts.lost_receipt.link_name'), lost_receipt_admin_booking_detail_receipts_path(booking_detail), class: "dropdown-item modal-remote-form-link" %>
<% end %>

<% if %w[hold blocked booked_tentative booked_confirmed scheme_approved].include?(booking_detail.status) && policy([:admin, Receipt.new(user: booking_detail.user, booking_detail: booking_detail, lead: booking_detail.lead)]).new? %>
  <%= link_to t('controller.booking_details.receipts.new.link_name'), new_admin_lead_booking_detail_receipt_path(booking_detail.lead, booking_detail_id: booking_detail.id), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% scheme = booking_detail.project_unit.present? ? booking_detail.project_unit.project_tower.default_scheme : nil %>

<% if booking_detail.booking_detail_scheme && policy([:admin, booking_detail.booking_detail_scheme]).edit? %>
  <%= link_to t('helpers.edit.link_name', model: BookingDetailScheme.model_name.human), edit_admin_booking_detail_booking_detail_scheme_path( booking_detail, booking_detail.booking_detail_scheme.id), class: 'dropdown-item modal-remote-form-link' %>
<% elsif scheme.present? && policy([:admin, BookingDetailScheme.new(booking_detail: booking_detail, derived_from_scheme_id: scheme.id, project_unit_id: booking_detail.project_unit_id)]).new?%>
  <%= link_to t('helpers.new.link_name', model: BookingDetailScheme.model_name.human ), new_admin_booking_detail_booking_detail_scheme_path( booking_detail), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if policy([:admin, Receipt ]).index? %>
  <%= link_to t('controller.receipts.index.link_name'), admin_lead_booking_detail_receipts_path(booking_detail.lead, booking_detail), class: 'dropdown-item' %>
<% end %>

<%= render 'admin/invoices/invoiceable_links', resource: booking_detail %>

<% booking_requests = [UserRequest::Cancellation, UserRequest::Swap] %>
<% booking_requests.each do |klass| %>
  <% if policy([:admin, klass.new(user_id: booking_detail.user_id, lead: booking_detail.lead, requestable_id: booking_detail.id, requestable_type: 'BookingDetail')]).new? %>
    <%= link_to t("controller.user_requests.#{klass.model_name.element}.new.link_name"), new_admin_lead_user_request_path(lead_id: booking_detail.lead_id, requestable_id: booking_detail.id, requestable_type: 'BookingDetail', request_type: klass.model_name.element), class: "dropdown-item modal-remote-form-link" %>
  <% end %>
<% end %>
