
<% if !params[:controller].include?('users') && policy([:admin, booking_detail.user]).show? %>
  <%= link_to t('controller.users.show.link_name', status: t("users.role.user")), admin_user_path(booking_detail.user), class: "dropdown-item" %>
<% end %>

<% if policy([ :admin, booking_detail.project_unit]).edit? %>
  <%= link_to t('controller.booking_details.edit.link_name'), edit_admin_project_unit_path(booking_detail.project_unit), class: "modal-remote-form-link dropdown-item" %>
<% end %>

<% if booking_detail.scheme_rejected? && policy([:admin, booking_detail.project_unit]).release_unit? %>
  <%= link_to t('controller.booking_details.release_unit.link_name'), release_unit_admin_project_unit_path(booking_detail.project_unit), method: :patch, class: 'dropdown-item' %>
<% end %>

<% if booking_detail.hold? && policy([:admin, booking_detail]).block? && booking_detail.search %>
  <%= link_to t('controller.booking_details.continue_booking.link_name'), checkout_user_search_path(booking_detail.search), class: 'dropdown-item' %>
<% end %>

<% unless params[:controller] == 'admin/booking_details' && params[:action] == 'show' %>
  <% if booking_detail.project_unit.assets.present? %>
    <%= link_to t('controller.assets.index.link_name'), "javascript:;", data: {toggle: "modal", target: "#floor_plan_modal_#{booking_detail.project_unit.id}"}, class: "dropdown-item" %>
  <% end %>

  <%= link_to t('controller.booking_details.cost_sheet.link_name'), "javascript:;", data: {toggle: "modal", target: "#cost_sheet_modal_#{booking_detail.id}"}, class: "dropdown-item" %>

  <%= link_to t('controller.booking_details.payment_schedule.link_name'), "javascript:;", data: {toggle: "modal", target: "#payment_schedule_modal_#{booking_detail.project_unit.id}"}, class: "dropdown-item" %>
<% end %>

<% if  policy([:admin, Receipt.new(user: booking_detail.user)]).lost_receipt? %>
  <%= link_to t('controller.receipts.lost_receipt.link_name'), lost_receipt_admin_booking_detail_receipts_path(booking_detail), class: "dropdown-item modal-remote-form-link" %>
<% end %>

<% if %w[hold blocked booked_tentative booked_confirmed scheme_approved].include?(booking_detail.status) && policy([:admin, Receipt.new(user: booking_detail.user, booking_detail: booking_detail)]).new? %>
  <%= link_to t('controller.receipts.new.link_name'), new_admin_user_booking_detail_receipt_path(booking_detail.user, booking_detail_id: booking_detail.id), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if policy([:admin, booking_detail]).show? && !(params[:controller] == 'admin/booking_details' && params[:action] == 'show') %>
  <%= link_to t('controller.booking_details.show.link_name'), admin_booking_detail_path(booking_detail), class: 'dropdown-item' %>
<% end %>

<% scheme = booking_detail.project_unit.project_tower.default_scheme %>

<% if booking_detail.booking_detail_scheme && policy([:admin, booking_detail.booking_detail_scheme]).edit? %>
  <%= link_to t('controller.booking_detail_schemes.edit.link_name'), edit_admin_booking_detail_booking_detail_scheme_path( booking_detail, booking_detail.booking_detail_scheme.id), class: 'dropdown-item modal-remote-form-link' %>
<% elsif policy([:admin, BookingDetailScheme.new(booking_detail: booking_detail, derived_from_scheme_id: scheme.id, project_unit_id: booking_detail.project_unit_id)]).new?%>
  <%= link_to t('controller.booking_detail_schemes.new.link_name'), new_admin_booking_detail_booking_detail_scheme_path( booking_detail), class: 'dropdown-item modal-remote-form-link' %>
<% end %>

<% if policy([:admin, Receipt ]).index? %>
  <%= link_to t('controller.receipts.index.link_name'), admin_user_booking_detail_receipts_path(booking_detail.user, booking_detail), class: 'dropdown-item' %>
<% end %>

<% UserRequest.descendants.each do |klass| %>
  <% if policy([:admin, klass.new(user_id: booking_detail.user_id, requestable_id: booking_detail.id, requestable_type: 'BookingDetail')]).new? %>
    <%= link_to t("controller.user_requests.#{klass.model_name.element}.new.link_name"), new_admin_user_user_request_path(user_id: booking_detail.user_id, requestable_id: booking_detail.id, requestable_type: 'BookingDetail', request_type: klass.model_name.element), class: "dropdown-item modal-remote-form-link" %>
  <% end %>
<% end %>
