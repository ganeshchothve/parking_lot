<% if policy([:admin, booking_detail]).show? && !(params[:controller] == 'admin/booking_details' && params[:action] == 'show') %>
  <%= link_to t('helpers.show.link_name', model: BookingDetail.model_name.human ), admin_booking_detail_path(booking_detail), class: 'dropdown-item' %>
<% end %>
<% if policy([:admin, booking_detail]).edit_booking_without_inventory?  %>
  <%= link_to 'Edit Booking', edit_booking_without_inventory_admin_booking_detail_path(booking_detail), class: 'dropdown-item modal-remote-form-link' %>
<% end %>
<% if booking_detail.agreement_date.present? && current_user.role?('account_manager_head') && policy([:admin, booking_detail]).move_to_next_state? && booking_detail.status == "blocked" %>
  <%= link_to 'Move to Booked Tentative', move_to_next_state_admin_booking_detail_path(booking_detail, status: 'booked_tentative', format: :json), method: 'patch', remote: true, data: { confirm: 'Are you sure? You cannot make changes once booking moved to tentative state', disable_with: "Please wait..." }, class: "dropdown-item queued move-to-next-state" %>
<% elsif ["billing_team", "account_manager_head"].include?(current_user.role) && booking_detail.status == "booked_tentative" %>
  <%= link_to 'Move to Booked Confirmed', move_to_next_state_admin_booking_detail_path(booking_detail, status: 'booked_confirmed', format: :json), method: 'patch', remote: true, data: {disable_with: "Please wait...", confirm: 'Are you sure?'  }, class: "dropdown-item queued move-to-next-state" %>
<% end %>
<% if (booking_detail.status == 'booked_tentative') && %w(billing_team).include?(current_user.role) %>
  <%= link_to 'Cancel Booking', move_to_next_state_admin_booking_detail_path(booking_detail, status: 'cancel', format: :json), method: 'patch', remote: true, data: { confirm: 'Are you sure?', disable_with: 'Cancelling...' }, class: 'dropdown-item dropoff move-to-next-state' %>
<% end %>
<% if policy([current_user_role_group, Asset.new(assetable: booking_detail) ]).update? %>
  <%= link_to t('controller.assets.index.link_name'), assetables_path(assetable_type: booking_detail.class.model_name.i18n_key.to_s, assetable_id: booking_detail.id), class: 'dropdown-item modal-remote-form-link' %>
<% end %>
<% if policy([current_user_role_group, booking_detail]).generate_booking_detail_form? && booking_detail.status == 'booked_confirmed' %>
  <%= link_to t('booking_details.links.print_booking_form'), generate_booking_detail_form_admin_booking_detail_path(booking_detail), class: 'dropdown-item', target: '_blank' %>
<% end %>
<%= render 'admin/invoices/invoiceable_links', resource: booking_detail %>

<%= javascript_tag do %>
  $(document).ready(function(){
    $('a.queued, a.dropoff').on('ajax:success', function(event) {
      setTimeout(function() {
        window.location.reload();
      }, 3000);
    });
  });
<% end %>

