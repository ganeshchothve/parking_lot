<!-- TO-DO - Add sourcing manager directory and move this there in dashboard views -->
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 mb-5">
  <div class="box-card relative table-responsive">
    <table class="table my-customer-table responsive-tbl caption-top rounded mt-3 mb-0">
      <thead class="th-default">
        <tr class="bg-primary white">
          <th><%= Project.model_name.human %></th>
          <th><%= I18n.t("global.all") %><br> <%= SiteVisit.model_name.human(count: 2) %></th>
          <th><%= t('mongoid.attributes.site_visit/status.scheduled') %><br> <%= SiteVisit.model_name.human(count: 2) %></th>
          <th><%= t('mongoid.attributes.site_visit/status.conducted') %><br> <%= SiteVisit.model_name.human(count: 2) %></th>
          <th><%= t('mongoid.attributes.site_visit/status.paid') %><br> <%= SiteVisit.model_name.human(count: 2) %></th>
          <th><%= t('mongoid.attributes.site_visit/approval_status.approved') %><br> <%= SiteVisit.model_name.human(count: 2) %></th>
        </tr>
      </thead>
      <tbody>
        <% projects = params[:project_ids].present? ? Project.filter_by__id(params[:project_ids]) : @projects %>
        <% projects.where(Project.user_based_scope(current_user)).each do |p| %>
          <tr>
            <td data-title='<%= Project.model_name.human %>'><%= p.name.titleize %></td>
            <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.scheduled") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @all_site_visits[p.id].try(:count) || 0, admin_site_visits_path(fltrs: {project_id: p.id, created_at: @dates, channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], project_ids: params[:project_ids]}) %></td>
            <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.scheduled") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @scheduled_site_visits[p.id].try(:count) || 0, admin_site_visits_path(fltrs: {status: 'scheduled', project_id: p.id, channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], scheduled_on: @dates}) %></td>
            <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.conducted") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @conducted_site_visits[p.id].try(:count) || 0, admin_site_visits_path(fltrs: {status: 'conducted', project_id: p.id, channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], scheduled_on: @dates}) %></td>
            <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.paid") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @paid_site_visits[p.id].try(:count) || 0, admin_site_visits_path(fltrs: {status: 'paid', project_id: p.id, channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], scheduled_on: @dates}) %></td>
            <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.approved") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @approved_site_visits[p.id].try(:count) || 0, admin_site_visits_path(fltrs: {approval_status: 'approved', project_id: p.id, channel_partner_id: params[:channel_partner_id], scheduled_on: @dates, manager_id: params[:manager_id]}) %></td>
          </tr>
        <% end %>
        <tr>
          <th data-title="<%= t('global.total') %>"><%= t('global.total') %></th>
          <td data-title='All <%= SiteVisit.model_name.human(count: 2) %>'><%= link_to @all_site_visits.values&.flatten&.count || 0, admin_site_visits_path(fltrs: {project_ids: params[:project_ids], created_at: @dates, channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], project_ids: params[:project_ids]}) %></td>
          <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.scheduled") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @scheduled_site_visits.values&.flatten&.count || 0, admin_site_visits_path(fltrs: {status: 'scheduled', channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], scheduled_on: @dates, project_ids: params[:project_ids]}) %></td>
          <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.conducted") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @conducted_site_visits.values&.flatten&.count || 0, admin_site_visits_path(fltrs: {status: 'conducted', channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], scheduled_on: @dates, project_ids: params[:project_ids]}) %></td>
          <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.paid") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @paid_site_visits.values&.flatten&.count || 0, admin_site_visits_path(fltrs: {status: 'paid', project_id: params[:project_ids], channel_partner_id: params[:channel_partner_id], manager_id: params[:manager_id], scheduled_on: @dates, project_ids: params[:project_ids]}) %></td>
          <td data-title='<%= I18n.t("mongoid.attributes.site_visit/status.approved") + " " + SiteVisit.model_name.human(count: 2) %>'><%= link_to @approved_site_visits.values&.flatten&.count || 0, admin_site_visits_path(fltrs: {approval_status: 'approved', project_ids: params[:project_ids], channel_partner_id: params[:channel_partner_id],manager_id: params[:manager_id], scheduled_on: @dates}) %></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
