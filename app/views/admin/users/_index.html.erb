<div class="table-responsive">
  <table class='table striped-table'>
    <thead class="th-default">
      <% labels = t('mongoid.attributes.user').with_indifferent_access %>
      <tr>
        <th>Name</th>
        <th><%= labels[:lead_id] %></th>
        <th><%= global_labels[:receipts] %></th>
        <th>Role</th>
        <th>Account Confirmed?</th>
        <th class="text-right">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% users.each do |user| %>
        <tr>
          <td>
            <%= user.name %>
            <div class="small">
              <%= user.email.present? ? user.email : "" %> <br/>
              <%= user.phone.present? ? user.phone : "" %><br/>
              <% if user.role?("user") && user.manager_id.present? && current_user.role != "channel_partner" %>
                CP: <%= user.manager.name %><br/>
              <% end %>
            </div>
          </td>
          <td><%= user.receipts.where(status: "success").present? ? "Y" : "N" %></td>
          <td><%= user.lead_id %></td>
          <td><%= User.available_roles(current_client).find{|x| x[:id] == user.role}[:text] %></td>
          <td>
            <%= user.confirmed_at.present? ? "Confirmed" : "Not confirmed" %>
          </td>
          <td class="text-right">
            <div class="dropdown">
              <a class="btn btn-light dropdown-toggle" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></a>
              <div class="dropdown-menu dropdown-menu-right">
                <% if current_client.enable_actual_inventory? && ProjectUnitPolicy.new(current_user, ProjectUnit.new(user: user, status: "available")).hold? %>
                  <%= link_to "Choose #{global_labels[:project_unit]} & Add Booking", new_admin_user_search_path(user.id), class: "dropdown-item" %>
                <% end %>
                <% if !current_user.buyer? && ReceiptPolicy.new(current_user, Receipt.new(user: user)).direct? %>
                  <%= link_to "Add Direct #{global_labels['receipt']}", direct_admin_user_receipts_path(user), class: 'dropdown-item modal-remote-form-link' %>
                <% end %>
                <% if UserPolicy.new(current_user, user).show? %>
                  <%= link_to "View Details", admin_user_path(user.id), class: "dropdown-item" %>
                <% end %>
                <% if UserPolicy.new(current_user, user).print? %>
                  <%= link_to "Print", print_admin_user_path(user.id), class: "dropdown-item" %>
                <% end %>
                <% if UserKycPolicy.new(current_user, UserKyc.new(user: user)).new? %>
                  <%= link_to "Add #{global_labels['user_kyc_details']}", new_admin_user_user_kyc_path(user), class: 'modal-remote-form-link dropdown-item', data:{event_category: 'Section', event_action: 'Click', event_name: 'Add User KYC Co Applicant'} %>
                <% end %>
                <% if !user.confirmed? && user.confirmation_token.present? %>
                  <%= link_to 'Resend Confirmation Instructions', resend_confirmation_instructions_admin_user_path(user), class: 'dropdown-item', data: {event_category: 'Section', event_action: 'Click', event_name: 'Resend Confirmation Instructions'} %>
                <% else %>
                  <%= link_to 'Send Password Reset Instructions', resend_password_instructions_admin_user_path(user), class: 'dropdown-item', data: {event_category: 'Section', event_action: 'Click', event_name: 'Reset Password Instructions'} %>
                <% end %>
                <% if UserPolicy.new(current_user, user).edit? %>
                  <%= link_to "Edit", edit_admin_user_path(user.id), class: "dropdown-item modal-remote-form-link" %>
                <% end %>
                <% if UserPolicy.new(current_user, user).update_password? %>
                  <%= link_to "Update Password", update_password_admin_user_path(user), class: "dropdown-item modal-remote-form-link" %>
                <% end %>
              </div>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<%= will_paginate users, list_classes: %w(pagination justify-content-center) %>
