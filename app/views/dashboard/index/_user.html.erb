<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      <% if current_user.project_units.size < 1 %>
      <div class="card">
        <div class="card-body">
          <h3 class="card-title text-center font-weight-bold text-uppercase">
            Launching <%= current_project.name %>
          </h3>
          <h6 class="card-subtitle text-muted text-center">
            Apartments Starting from <%= number_to_indian_currency(0) %>
          </h6>
          <div class="mt-3"></div>
          <hr/>
          <div class="text-center">
            Placeholder content
            Skip the rush and get priority access by paying just <%= number_to_indian_currency(ProjectUnit.blocking_amount) %>.
          </div>
          <hr/>
          <div class="mt-3"></div>
          <div class="form-group text-center">
            <% if current_user.buyer? && policy(Receipt.new(user: current_user)).direct? %>
              <%= link_to "Pay Now & Generate Token", direct_user_receipts_path, class: 'btn btn-primary modal-remote-form-link' %>
            <% elsif UserKycPolicy.new(current_user, UserKyc.new(user: current_user)).new? && current_user.buyer? %>
                <%= link_to "Add #{global_labels['user_kyc']} & Make Payment", new_user_kyc_path, class: 'btn btn-primary modal-remote-form-link' %>
            <% end %>
          </div>
        </div>
      </div>
      <% else %>
      <div class="card">
        <div class="card-body">
          <% if policy(:dashboard).project_units? && ProjectUnitPolicy.new(current_user, ProjectUnit.new(user: current_user, status: "available")).hold? %>
            <a class="btn btn-primary" href="<%= new_search_path %>">Apartment Selector</a>
          <% end %>
          <% if current_user.kyc_ready? %>
            <% hold_unit = current_user.project_units.where(status: 'hold').first %>
            <% if hold_unit.present? %>
              <p>
                We have kept a unit on hold for you; to proceed with booking it, click <a href="/search/checkout/<%= hold_unit.id %>" data-event-category="section" data-event-action="click" data-event-name="book now">here</a>
              </p>
            <% end %>
          <% end %>
          <% if current_user.kyc_ready? && current_user.project_units.in(status: ['blocked', 'booked_tentative', 'booked_confirmed']).count >= current_user.allowed_bookings %>
            <p>
              You cannot book any more apartments as you have reached the maximum bookings allowed per customer.
            </p>
          <% end %>
        </div>
      </div>
      <div class="mt-3"></div>
      <div class="card">
        <div class="card-body">
          <% current_user.project_units.where(status: 'hold').each do |project_unit| %>
            <%= render 'dashboard/project_unit_overview', {project_unit: project_unit, with_actions: true} %>
            <div class="mt-3"></div>
          <% end %>
          <% current_user.project_units.ne(status: 'hold').each do |project_unit| %>
            <%= render 'dashboard/project_unit_overview', {project_unit: project_unit, with_actions: true} %>
            <div class="mt-3"></div>
          <% end %>
          <a href="/dashboard/apartment-selector" class="btn btn-primary mt-3" data-event-category="section" data-event-action="click" data-event-name="Book Another Home">
            Book Another Home
          </a>
        </div>
      </div>
      <% receipts = current_user.receipts.where(status: 'clearance_pending') %>
      <% if receipts.present? %>
        <div class="mt-3"></div>
        <div class="card">
          <div class="card-body">
            <% receipts.each do |receipt| %>
              <% if receipt.status == 'clearance_pending' && receipt.project_unit_id.blank? && receipt.reference_project_unit_id.present? && receipt.reference_project_unit.user_based_status(receipt.user) == 'available' %>
                 To block chosen unit: <%= ProjectUnit.find(receipt.reference_project_unit_id).name %> <a href='<%= dashboard_checkout_via_email_url(project_unit_id: receipt.reference_project_unit_id, receipt_id: receipt.receipt_id) %>'>Click here</a>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
      <% end %>
    </div>
  </div>
</div>
