<section class="user-db-sec-4 device-pd">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 no-pd">
        <div class="table-title pt-4">
          <img src="<%= asset_path 'chart-line.svg' %>" alt="user icon"> <h1 class="title"><%= t('dashboard.channel_partner.titles.leads') %></h1>
        </div>
      </div>
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
        <div class="row no-mg">
          <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-4 no-sm-pd">
            <div class="leads-box">
              <div class="leads-box-inner">
                <img src="<%= asset_path 'leader-1.png' %>" alt="leads icon">
                <span class="numbers"><%= @total_buyers %></span>
                <p class="title"><%= t('dashboard.channel_partner.titles.total_leads') %><br><%= t('dashboard.channel_partner.titles.received') %></p>
                <!-- <p class="desc">Lorem Ipsum is simply dummy text of the printing and typesetting</p> -->
              </div>
            </div>
          </div>
          <div class="box-card col-lg-8 col-md-12 col-sm-12 col-xs-12 mt-4 br-rd-4 bg-white">
            <div class="row">
              <div class="col-lg-6 col-md-12 col-xs-12 col-sm-12">
                <h2 class="chart-title pt-4 mt-2 mb-5 pb-5 pl-4"><%= t('dashboard.channel_partner.titles.lead_details') %></h2>
                <canvas id="myChart" height="300" width="320"></canvas>
              </div>
              <div class="col-lg-6 col-md-12 col-xs-12 col-sm-12 relative br-lft">
                <h2 class="chart-title pt-4 mt-2 pb-5"><%= t('dashboard.channel_partner.titles.booking_details') %></h2>
                <canvas id="barChart" height="300" class="pl-3 pr-3"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="user-db-sec-4 device-pd">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
        <div class="row">
          <div class="box-card col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
            <h2><img src="<%= asset_path 'rupee-white.svg' %>" alt="<%= Receipt.model_name.human(count: @receipts.total_entries) %>" class="wd-10"><%= Receipt.model_name.human(count: @receipts.total_entries) %></h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white fix-ht-420">
              <div class="row pd-box">
                <ul class="db-user-no-list pt-5 mt-2">
                  <% @grouped_receipts.each do |key, value| %>
                    <li><span class="number"><%= value %></span><p class="title"><%= t("mongoid.attributes.receipt/status.#{key}")%></p>
                    <!-- <span class="prjt-no">Total Projects: 05</span><span class="update-info">last updated a week ago</span> -->
                    </li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
          <div class="box-card col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
              <h2><img src="<%= asset_path 'rupee-white.svg' %>" alt="Incentives" class="wd-10">My Incentives</h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white fix-ht-420">
              <div class="row pd-box">
                <ul class="db-user-no-list pt-3 mt-3">
                  <li><span class="number"><%= @bookings_with_incentive_generated %></span><p class="title">Bookings with<br>incentive generated</p></li>
                  <li><span class="number"><%= number_to_inr(@incentive_approved, {precision: 2, significant: false}) %></span><p class="title">Incentive<br>approved</p></li>
                  <li><span class="number"><%= number_to_inr(@incentive_generated, {precision: 2, significant: false}) %></span><p class="title">Incentive<br>generated</p></li>
                  <li><span class="number"><%= @incentive_pending_bookings %></span><p class="title">Bookings with<br>pending incentive</p></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="user-db-sec-5 device-pd">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
        <div class="row">
          <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4 text-center">
              <h2>Total <%= BookingDetail.model_name.human(count: 2) %></h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white py-3 text-center fix-ht">
              <span class='cp-dashboard-box-font'>
                <%= @booking_count_booking_stages %>
              </span>
            </div>
          </div>
          <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4 text-center">
              <h2>Total <%= UserRequest::Cancellation.model_name.human(count: 2)  %></h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white py-3 text-center fix-ht">
              <span class='cp-dashboard-box-font'>
                <%= @booking_count_request_stages %>
              </span>
            </div>
          </div>
          <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4 text-center">
              <h2>Conversion Rate</h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white py-3 text-center fix-ht">
              <span class='cp-dashboard-box-font'>
                <%= number_to_percentage(@conversion_rate, precision: 0) %>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<%= javascript_tag do %>
  var ctx1 = document.getElementById("myChart");
  var myChart = new Chart(ctx1, {
    type: 'doughnut',
    data: {
      labels: <%= @lead_details_labels.to_json.html_safe %>,
      datasets: [{
        label: '# of Tomatoes',
        data: <%=  @lead_data.to_json.html_safe %>,
        backgroundColor: ['#1f3bb3','#fed1c8']
      }]
    },
    options: {
      cutoutPercentage: 60,
      responsive: false,
      legend: {
          fullWidth: true,
          position: 'bottom',
              display: true,
              labels: {
                  fontColor: '#333d51',
                  padding: 30,
                  boxWidth: 12,
              }
          }
    }
  });
  var canvas = document.getElementById("barChart");
  var ctx = canvas.getContext('2d');
  // Global Options:
  Chart.defaults.global.defaultFontColor = 'dodgerblue';
  Chart.defaults.global.defaultFontSize = 10;

  // Data with datasets options
  var data = {
      labels: <%= @booking_detail_labels.to_json.html_safe %>,
        datasets: [
          {
              fill: true,
              backgroundColor: ['#8ddf8b','#1f3bb3','#5f79ea'],
              data: <%= @booking_data.to_json.html_safe %>
          }
      ]
  };
  var options = {
    tooltips: {
          callbacks: {
              label: function(tooltipItem) {
                  return Number(tooltipItem.yLabel);
              }
          }
      },
      legend:{
        display: false,
      },
      title: {
                display: false,
            },
      scales: {
          yAxes: [{
              ticks: {
                fontColor: "#1f3bb3",
                  beginAtZero:true,
                  stacked: false
              }
          }],
          xAxes: [{

            stacked: true,
              barPercentage: 1,
              barThickness: 65,
              maxBarThickness: 80,
              minBarLength: 20,
              gridLines: {
                offsetGridLines: true,
                  color: "#ffffff"
              },
              ticks: {
                fontColor: "#1f3bb3"
              }
          }]
      },
      hover: {
          animationDuration: 1
      },
      animation: {
          duration: 1,
          onComplete: function () {
              var chartInstance = this.chart,
              ctx = chartInstance.ctx;
              ctx.textAlign = 'center';
              ctx.fillStyle = "#1f3bb3";
              ctx.textBaseline = 'bottom';

              this.data.datasets.forEach(function (dataset, i) {
                  var meta = chartInstance.controller.getDatasetMeta(i);
                  meta.data.forEach(function (bar, index) {
                      var data = dataset.data[index];
                      ctx.fillText(data, bar._model.x, bar._model.y - 5);

                  });
              });
          }
      }
  };
  // Chart declaration:
  var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: data,
      options: options
  });
<% end %>