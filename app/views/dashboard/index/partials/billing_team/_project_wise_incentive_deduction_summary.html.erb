<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 no-pd">
  <div class="table-title pt-4">
    <h1 class="title fn-18 theme-txt-color">Project Wise Incentive Deduction Summary</h1>
  </div>
</div>
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 no-pd">
  <div class="box-card relative table-responsive" id="dashboard_project_wise_incentive_deduction_summary">
    <table class="table my-customer-table responsive-tbl mb-0 align-middle">
      <thead class="th-default">
        <tr class="bg-primary white">
          <th rowspan='2' class='text-center border-end th-border-right align-middle'><%= Project.model_name.human %></th>
          <th colspan='4' class='text-center'>No. of <%= IncentiveDeduction.model_name.human(count:2) %></th>
        </tr>
        <tr class="bg-primary white text-center">
          <th><%= t('mongoid.attributes.incentive_deduction/status.draft') %></th>
          <th><%= t('mongoid.attributes.incentive_deduction/status.pending_approval') %></th>
          <th><%= t('mongoid.attributes.incentive_deduction/status.approved') %></th>
          <th><%= t('mongoid.attributes.incentive_deduction/status.rejected') %></th>
        </tr>
      </thead>
      <tbody class='text-md-center'>
        <% @deduction_data.sort_by{|x| x[:project_name]}.group_by{|x| x[:project_name]}.each do |project_name, data| %>
          <tr>
            <td data-title='<%= Project.model_name.human %>' class='text-md-left'><%= project_name %></td>
            <td data-title='No. of <%= "#{IncentiveDeduction.model_name.human(count:2)} (#{t('mongoid.attributes.incentive_deduction/status.draft')})" %>'>
              <%= data.find {|x| x[:status] == 'draft'}.try(:[], :count) || 0 %>
            </td>
            <td data-title='No. of <%= "#{IncentiveDeduction.model_name.human(count:2)} (#{t('mongoid.attributes.incentive_deduction/status.pending_approval')})" %>'>
              <%= data.find {|x| x[:status] == 'pending_approval'}.try(:[], :count) || 0 %>
            </td>
            <td data-title='No. of <%= "#{IncentiveDeduction.model_name.human(count:2)} (#{t('mongoid.attributes.incentive_deduction/status.approved')})" %>'>
              <%= data.find {|x| x[:status] == 'approved'}.try(:[], :count) || 0 %>
            </td>
            <td class='non-action-td' data-title='No. of <%= "#{IncentiveDeduction.model_name.human(count:2)} (#{t('mongoid.attributes.incentive_deduction/status.rejected')})" %>'>
              <%= data.find {|x| x[:status] == 'rejected'}.try(:[], :count) || 0 %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-4 no-pd">
  <div class="box-card relative table-responsive" id="dashboard_project_wise_invoice_summary">
    <table class="table my-customer-table responsive-tbl mb-0">
      <thead class="th-default">
        <tr class="bg-primary white">
          <th rowspan='2' class='text-center border-end th-border-right align-middle'><%= Project.model_name.human %></th>
          <th colspan='4' class='text-center'>Total <%= t('mongoid.attributes.incentive_deduction.amount') %></th>
        </tr>
        <tr class="bg-primary white text-center">
          <th><%= t('mongoid.attributes.incentive_deduction/status.draft') %></th>
          <th><%= t('mongoid.attributes.incentive_deduction/status.pending_approval') %></th>
          <th><%= t('mongoid.attributes.incentive_deduction/status.approved') %></th>
          <th><%= t('mongoid.attributes.incentive_deduction/status.rejected') %></th>
        </tr>
      </thead>
      <tbody class='text-md-center'>
        <% @deduction_data.sort_by{|x| x[:project_name]}.group_by{|x| x[:project_name]}.each do |project_name, data| %>
          <tr>
            <td data-title='<%= Project.model_name.human %>' class='text-md-left'><%= project_name %></td>
            <td data-title='Total <%= "#{t('mongoid.attributes.incentive_deduction.amount')} (#{t('mongoid.attributes.incentive_deduction/status.draft')})" %>'>
              <%= number_to_indian_currency(data.find {|x| x[:status] == 'draft'}.try(:[], :amount) || 0) %>
            </td>
            <td data-title='Total <%= "#{t('mongoid.attributes.incentive_deduction.amount')} (#{t('mongoid.attributes.incentive_deduction/status.pending_approval')})" %>'>
              <%= number_to_indian_currency(data.find {|x| x[:status] == 'pending_approval'}.try(:[], :amount) || 0) %>
            </td>
            <td data-title='Total <%= "#{t('mongoid.attributes.incentive_deduction.amount')} (#{t('mongoid.attributes.incentive_deduction/status.approved')})" %>'>
              <%= number_to_indian_currency(data.find {|x| x[:status] == 'approved'}.try(:[], :amount) || 0) %>
            </td>
            <td class='non-action-td' data-title='Total <%= "#{t('mongoid.attributes.incentive_deduction.amount')} (#{t('mongoid.attributes.incentive_deduction/status.rejected')})" %>'>
              <%= number_to_indian_currency(data.find {|x| x[:status] == 'rejected'}.try(:[], :amount) || 0) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>