<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 no-pd">
  <div class="table-title pt-4">
    <h1 class="title  fn-18 theme-txt-color">Invoice Ageing Report</h1>
  </div>
</div>
<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 no-pd">
  <div class="box-card relative table-responsive" id="dashboard_invoice_ageing_report">
    <table class="table my-customer-table responsive-tbl mb-0 align-middle">
      <thead class="th-default">
        <tr class="bg-primary white">
          <th rowspan='2' class='text-center border-end th-border-right align-middle'><%= Project.model_name.human %></th>
          <th colspan='4' class='text-center'>No. of <%= Invoice.model_name.human(count:2) %> Raised</th>
        </tr>
        <tr class="bg-primary white text-center">
          <th><%= "#{2.days.inspect} ago".titleize %></th>
          <th><%= "#{3.days.inspect} ago".titleize %></th>
          <th><%= "#{4.days.inspect} ago".titleize %></th>
          <th><%= ">#{4.days.inspect} ago".titleize %></th>
        </tr>
      </thead>
      <tbody class='text-md-center'>
        <% @invoice_age_data.sort_by{|x| x[:project_name]}.group_by{|x| x[:project_name]}.each do |project_name, data| %>
          <tr>
            <td data-title='<%= Project.model_name.human %>' class='text-md-left'><%= project_name %></td>
            <% (2..5).to_a.each_with_index do |num, idx| %>
              <% if idx < 3 %>
                <td data-title='<%= "No. of #{Invoice.model_name.human(count:2)} Raised #{num.days.inspect.titleize} Ago" %>'>
                  <%= data.find { |x| x[:age] == num }.try(:[], :count) || 0 %>
                </td>
              <% else %>
                <td class='non-action-td' data-title='<%= "No. of #{Invoice.model_name.human(count:2)} Raised >#{(num-1).days.inspect.titleize} Ago" %>'>
                  <%= data.select { |x| x[:age] > num-1 }.sum { |x| (x[:count] || 0) } || 0 %>
                </td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>