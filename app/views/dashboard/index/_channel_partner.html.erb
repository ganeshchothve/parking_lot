<% channel_partner = ChannelPartner.where(associated_user_id: current_user.id).first %>
<section class="first-sec welcome-box">
  <div class="container">
    <div class="row">
      <% template = ::Template::UITemplate.where(name: 'index/_channel_partner').first %>
      <% if template.present? %>
        <%= get_view_erb(template) %>
      <% end %>
    </div>
  </div>
</section>

<!-- Projects -->
<%= render 'project_units/section' %>

<section class="user-db-sec-4 device-pd">
  <div class="container">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3 no-pd">
          <div class="table-title pt-4">
            <img src="<%= asset_path 'chart-line.svg' %>" alt="user icon"> <h1 class="title"><%= t('dashboard.channel_partner.titles.leads') %></h1>
          </div>
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
          <div class="row no-mg">
            <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-4 no-sm-pd">
              <div class="leads-box">
                <div class="leads-box-inner">
                  <img src="<%= asset_path 'leader-1.png' %>" alt="leads icon">
                  <span class="numbers"><%= DashboardDataProvider.total_buyers(current_user) %></span>
                  <p class="title"><%= t('dashboard.channel_partner.titles.total_leads') %><br><%= t('dashboard.channel_partner.titles.received') %></p>
                  <!-- <p class="desc">Lorem Ipsum is simply dummy text of the printing and typesetting</p> -->
                </div>
              </div>
            </div>
            <div class="box-card col-lg-8 col-md-12 col-sm-12 col-xs-12 mt-4 br-rd-4 bg-white">
              <div class="row">
                <div class="col-lg-6 col-md-12 col-xs-12 col-sm-12">
                  <h2 class="chart-title pt-4 mt-2 mb-5 pb-5 pl-4"><%= t('dashboard.channel_partner.titles.lead_details') %></h2>
                  <canvas id="myChart" height="300" width="320"></canvas>
                </div>
                <div class="col-lg-6 col-md-12 col-xs-12 col-sm-12 relative br-lft">
                  <h2 class="chart-title pt-4 mt-2 pb-5"><%= t('dashboard.channel_partner.titles.booking_details') %></h2>
                  <canvas id="barChart" height="300" class="pl-3 pr-3"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
</section>


<section class="user-db-sec-4 device-pd">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
        <div class="row">
          <div class="box-card col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
            <h2><img src="<%= asset_path 'rupee-white.svg' %>" alt="<%= Receipt.model_name.human(count: @receipts.total_entries) %>" class="wd-10"><%= Receipt.model_name.human(count: @receipts.total_entries) %></h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white fix-ht-420">
              <div class="row pd-box">
                <ul class="db-user-no-list pt-5 mt-2">
                  <% DashboardDataProvider.receipts_group_by(current_user).each do |key, value| %>
                    <li><span class="number"><%= value %></span><p class="title"><%= t("mongoid.attributes.receipt/status.#{key}")%></p>
                    <!-- <span class="prjt-no">Total Projects: 05</span><span class="update-info">last updated a week ago</span> -->
                    </li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
          <div class="box-card col-lg-6 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
            <h2><img src="<%= asset_path 'rupee-white.svg' %>" alt="Incentives" class="wd-10">My Incentives</h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white fix-ht-420">
              <div class="row pd-box">
                <ul class="db-user-no-list pt-3 mt-3">
                  <li><span class="number"><%= DashboardDataProvider.booking_detail_group_by(current_user)[:booked_confirmed] %></span><p class="title">No of bookings<br>in confirm stage</p></li>
                  <li><span class="number"><%= number_to_inr(Invoice.where(manager_id: current_user.id, status: 'approved').sum(:amount) || 0) %></span><p class="title">Incentive<br>approved</p></li>
                  <li><span class="number"><%= number_to_inr(Invoice.where(manager_id: current_user.id, status: {'$ne': 'rejected'}).sum(:amount) || 0) %></span><p class="title">Incentive<br>generated</p></li>
                  <li><span class="number"><%= DashboardDataProvider.incentive_pending_bookings(current_user) %></span><p class="title">No of bookings<br>with pending incentive</p></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="user-db-sec-5 device-pd">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
        <div class="row">
          <%= render 'dashboard/index/partials/collaterals' %>
          <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-5 referrals">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
            <h2><img src="<%= asset_path 'users-white.svg' %>"  alt="Refer a Friend" class="wd-20"><%= t('dashboard.channel_partner.refer_a_channel_partner.heading') %></h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white fix-ht">
              <div class="pd-box">
                <div class="col-lg-12 col-xs-12 col-md-12 col-sm-12">
                  <p class="fn-14 content-clr"><%= t('dashboard.channel_partner.refer_a_channel_partner.sub_heading', project_name: current_project.name) %></p>
                  <a href="javascript:;" class="large-btn bg-light-blue display-block fn-500 text-uppercase">Refer Now&nbsp;&nbsp;></a>
                </div>
              </div>
            </div>
          </div>

          <div class="box-card col-lg-4 col-md-12 col-sm-12 col-xs-12 mt-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
              <h2><img src="<%= asset_path 'leaderboard-white.svg' %>" alt="Documents" class="wd-16">Leaderboard</h2>
              <a href="javascript:;" class="view-all-btn">View All > </a>
            </div>
            <div class="box-content br-rd-bl-4 bg-white fix-ht pt-0">
              <div class="row pd-box">
                <div class="col-lg-12 col-xs-12 col-md-12 col-sm-12 no-pd">
                  <ul class="leaderboard-list">
                    <li class="mt-4">
                      <div class="display-inline user-icon">
                        <img src="<%= asset_path 'user.jpg' %>" alt="user img">
                      </div>
                      <div class="display-inline user-info">
                        <span class="rank-type display-block fn-300 fn-12">Rank: 01</span>
                        <span class="name-point display-block fn-500 fn-14">Prathyush Shetty<br>Points: 1002</span>
                      </div>
                    </li>
                    <li class="mt-4">
                      <div class="display-inline user-icon">
                        <img src="<%= asset_path 'user-2.png' %>" alt="user img">
                      </div>
                      <div class="display-inline user-info">
                        <span class="rank-type display-block fn-300 fn-12">Rank: 02</span>
                        <span class="name-point display-block fn-500 fn-14">Akshay Patil<br>Points: 970</span>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="user-db-sec-6 mt-5 device-pd">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 no-pd">
        <div class="row">
          <div class="box-card col-lg-12 col-md-12 col-sm-12 col-xs-12 mb-5">
            <div class="box-header bg-gradient-cd br-rd-tr-4">
            <h2><img src="<%= asset_path 'rupee-white.svg' %>" alt="Documents" class="wd-10"><%= t('dashboard.channel_partner.incentive_plan.heading') %></h2>
            </div>
            <div class="box-content br-rd-bl-4 bg-white">
              <div class="row pd-box">
              <div class="col-lg-6 col-xs-12 col-md-12 col-sm-12">
                <p class="p-style"><%= t('dashboard.channel_partner.incentive_plan.sub_heading_html') %></p>
              </div>
              <div class="col-lg-6 col-xs-12 col-md-12 col-sm-12">
                <textarea placeholder="Need help? Post your query here..." class="form-control"></textarea>
                <button class="small-btn bg-light-blue display-block fn-500 mt-3" type="button">Submit</button>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script type="text/javascript">
var ctx1 = document.getElementById("myChart");
var myChart = new Chart(ctx1, {
  type: 'doughnut',
  data: {
    labels: <%= @lead_details_labels.to_json.html_safe %>,
    datasets: [{
      label: '# of Tomatoes',
      data: <%= DashboardDataProvider.user_group_by(current_user).values.to_json.html_safe %>,
      backgroundColor: ['#1f3bb3','#fed1c8']
    }]
  },
  options: {
    cutoutPercentage: 60,
    responsive: false,
    legend: {
        fullWidth: true,
        position: 'bottom',
            display: true,
            labels: {
                fontColor: '#333d51',
                padding: 30,
                boxWidth: 12,
            }
        }
  }
});



var canvas = document.getElementById("barChart");
var ctx = canvas.getContext('2d');

// Global Options:
 Chart.defaults.global.defaultFontColor = 'dodgerblue';
 Chart.defaults.global.defaultFontSize = 10;

// Data with datasets options
var data = {
    labels: <%= @booking_detail_labels.to_json.html_safe %>,
      datasets: [
        {
            fill: true,
            backgroundColor: ['#8ddf8b','#1f3bb3','#5f79ea'],
            data: <%= DashboardDataProvider.booking_detail_group_by(current_user).values.to_json.html_safe %>
        }
    ]
};

var options = {
  tooltips: {
        callbacks: {
            label: function(tooltipItem) {
                return Number(tooltipItem.yLabel);
            }
        }
    },
    legend:{
      display: false,
    },
    title: {
              display: false,
          },
    scales: {
        yAxes: [{
            ticks: {
              fontColor: "#1f3bb3",
                beginAtZero:true,
                stacked: false
            }
        }],
        xAxes: [{

          stacked: true,
            barPercentage: 1,
            barThickness: 65,
            maxBarThickness: 80,
            minBarLength: 20,
            gridLines: {
              offsetGridLines: true,
                color: "#ffffff"
            },
            ticks: {
              fontColor: "#1f3bb3"
            }
        }]
    },
     hover: {
        animationDuration: 1
    },
    animation: {
        duration: 1,
        onComplete: function () {
            var chartInstance = this.chart,
            ctx = chartInstance.ctx;
            ctx.textAlign = 'center';
            ctx.fillStyle = "#1f3bb3";
            ctx.textBaseline = 'bottom';

            this.data.datasets.forEach(function (dataset, i) {
                var meta = chartInstance.controller.getDatasetMeta(i);
                meta.data.forEach(function (bar, index) {
                    var data = dataset.data[index];
                    ctx.fillText(data, bar._model.x, bar._model.y - 5);

                });
            });
        }
    }
};

// Chart declaration:
var myBarChart = new Chart(ctx, {
    type: 'bar',
    data: data,
    options: options
});

</script>
