//= require jquery.bxslider.min
//= require_self

var aArray = [];
var wn_width = $(window).width();
var wn_height = $(window).height();
var wind_height = $('.header').outerHeight();
$(document).ready(function () {
  $(".project-slider").bxSlider({
    mode: 'fade',
    infiniteLoop: true,
    auto: true,
    pager: false,
    controls: true,
    pause: 14000,
    speed: 800,
    infiniteLoop: true,
    responsive: true,
    touchEnabled: true,
    nextText: '>',
    prevText: '<'
  });
  $('.header-search-icon').click(function () {
    $('.icon-search').toggleClass('close');
  });
  $('.pwd-btn').click(function () {
    if ($(this).hasClass('show-pwd')) {
      $(this).removeClass('show-pwd').addClass('hide-pwd')
      $(this).children().removeClass('fa-eye-slash').addClass('fa-eye');
      $('.pwd-field').attr('type', 'text');
    } else {
      $('.pwd-field').attr('type', 'password');
      $(this).removeClass('hide-pwd').addClass('show-pwd')
      $(this).children().removeClass('fa-eye').addClass('fa-eye-slash');
    }
  });
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })

  var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
  var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
  });
  // var popover = new bootstrap.Popover(document.querySelector('.popover-dismiss'), {
  //   trigger: 'focus'
  // })
 
  $('body').on('click', '.theme-tab a', function (options) {

    var opts = {
      delayTime: 300
    };
    options = options || {};
    opts = $.extend(opts, options);
    // return this.each(function() {
    $(this).on('click', function (event) {
      event.preventDefault();
      var sum = 0;
      $(this).prevAll().each(function () {
        sum += $(this).width();
      });
      var get = document.getElementsByClassName('theme-tab').scrollWidth;
      var dist = sum - ($(this).parent().width() - $(this).width()) / 2;
      if (dist < 0) {
        dist = 0;
      } else if (dist + sum > get) {
        dist = get - sum + dist + dist;
      }
      $(this).parent().animate({
          scrollLeft: dist
        },
        opts['delayTime']);
    });
    // });
  });

  $('.db-filter-btn').click(function () {
    if ($(this).parents('.box-card').length) {
      $(this).parents('.box-card').find('.filter-box').slideToggle('slow')
    } else {
      // for index pages
      $('.filter-box').slideToggle('slow');
    }
  });
  $('body').on('click', '.f-cancel-btn, .close-filter-btn', function () {
    if ($(this).parents('.box-card').length) {
      $(this).parents('.box-card').find('.filter-box').slideToggle('slow')
    } else {
      // for index pages
      $('.filter-box').slideToggle('slow');
    }
  });
  $(".scroll-sec").click(function () {
    $(".scroll-sec").removeClass('active');
    var curnt_id = $(this).attr('rel');
    $(this).addClass('active');
    scroll_cost = $('#apartment').outerHeight(true) + 20;
    scroll_payment = $('#apartment').outerHeight(true) + $('#cost-sheet').height() + 40;

    if (curnt_id == 'apartment') {
      $('.scroll-fixed-height').animate({
        scrollTop: 0
      }, 1000);
    }
    if (curnt_id == 'cost-sheet') {
      $('.scroll-fixed-height').animate({
        scrollTop: scroll_cost
      }, 1000);
    }
    if (curnt_id == 'payment-schedule') {
      $('.scroll-fixed-height').animate({
        scrollTop: scroll_payment
      }, 1000);
    }

  });

  var childrenSelector = $(".prjt-menu a");
  var aChildren = $(".prjt-menu a"); // find the a children of the list items
  if (wn_width <= 700)
    var gap = 60; // $(".header-wrapper").outerHeight(); //Navigation height
  else
    var gap = 70;
  var aArray = []; // create the empty aArray
  for (var i = 0; i < childrenSelector.length; i++) {
    var aChild = aChildren[i];
    if (!$(aChild).hasClass('extLink')) {
      if ($(aChild).attr('rel')) {
        var ahref = $(aChild).attr('rel');
        aArray.push(ahref);
      }
    }
  }
  //On Scroll - Add class active to active tab
  $(window).scroll(function () {
    var windowPos = $(window).scrollTop(); // get the offset of the window from the top of page
    var windowHeight = $(window).height(); // get the height of the window
    var docHeight = $(document).height();
    for (i = 0; i < aArray.length; i++) {
      var theID = aArray[i];
      var divPos = $("#" + theID).offset().top; // get the offset of the div from the top of page
      var divHeight = $("#" + theID).outerHeight(); // get the height of the div in question
      if (windowPos >= (divPos - gap) && windowPos < ((divPos - gap) + divHeight)) {
        if (!$("a[rel='" + theID + "']").hasClass("active")) {
          $("a[rel='" + theID + "']").addClass("active");
        }
      } else {
        $("a[rel='" + theID + "']").removeClass("active");
      }
    }

    //If document has scrolled to the end. Add active class to the last navigation menu
    if (windowPos + windowHeight == docHeight) {
      if (!$(".prjt-menu a:not(.extLink):last-child").hasClass("active")) {
        var navActiveCurrent = $(".active").attr("rel");
        $("a[rel='" + navActiveCurrent + "']").removeClass("active");
        $(".prjt-menu a:not(.extLink):last-child").addClass("active");
      }
    }
  });
  $('.prjt-menu a').on("click", function () {
    console.log('click')
    if (!$(this).hasClass('extLink')) {
      var href = $(this).attr("rel");
      var gap = 120;

      $('html,body').animate({
        scrollTop: $("#" + href).offset().top - gap
      }, 1000);
    }
  });
});